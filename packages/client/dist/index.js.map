{"version":3,"file":"index.js","sources":["../src/getGraphQLErrorCode.js","../src/debug.js","../src/Session.js","../src/getClient.js","../src/getSubdomain.js","../src/firebaseConfig.js","../src/PageContainer.js","../src/subdomainApps.js","../src/useRouter.js"],"sourcesContent":["import get from 'lodash.get';\n\nexport default function getGraphQLErrorCode (error) {\n  let code = get(error, 'graphQLErrors[0].extensions.code', null);\n  if (!code) {\n    code = get(error, 'networkError.result.errors[0].extensions.code', null);\n  }\n  return code;\n}\n","import {default as makeDebug} from 'debug';\n\nconst debug = makeDebug('jump');\n\nexport default debug;\n","import * as React from 'react';\nimport {\n  createContext,\n  useContext,\n  useState,\n  useEffect\n} from 'react';\nimport PropTypes from 'prop-types';\nimport Firebase from 'firebase/app';\nimport 'firebase/auth';\n\nimport getGraphQLErrorCode from './getGraphQLErrorCode';\nimport debug from './debug';\n\nconst SessionContext = createContext();\n\nfunction SessionProvider ({client, children, SessionUser, Loading, popup = true}) {\n  const [loaded, setLoaded] = useState(false);\n  const [error, setError] = useState(null);\n  const [user, _setUser] = useState(new SessionUser(null));\n\n  function setUser (data) {\n    debug('Setting session user', data);\n    const user = new SessionUser(data);\n    _setUser(user);\n  }\n\n  useEffect(()=> {\n    const auth = Firebase.auth();\n    const unsubscribe = auth.onAuthStateChanged(async (firebase_user)=> {\n      debug('Firebase auth state changed', firebase_user);\n      try {\n        if (firebase_user) {\n          debug('Getting firebase user token');\n          const token = await firebase_user.getIdToken(true);\n          client.setToken(token);\n\n          debug('Loading session user');\n          const user = await SessionUser.load({client, token, firebase_user});\n          setUser(user);\n        } else {\n          client.clearToken();\n          setUser(null);\n        }\n      } catch (error) {\n        debug('Session error', error);\n        const code = getGraphQLErrorCode(error);\n        if (code) {\n          setError(code);\n        } else {\n          setError('Session error');\n        }\n      } finally {\n        debug('Session loaded');\n        setLoaded(true);\n      }\n    });\n\n    return ()=> {\n      debug('Unsubscribing from firebase auth state listener');\n      unsubscribe();\n    };\n  }, []);\n\n  async function start ({email, password, provider: provider_name}) {\n    debug('Starting session', email, provider_name);\n    const auth = Firebase.auth();\n    const provider_method = popup ? 'signInWithPopup' : 'signInWithRedirect';\n    const dedicated_providers = ['Google', 'Facebook', 'Twitter', 'Github'];\n    const oauth_providers = ['Yahoo', 'Microsoft', 'Apple'];\n\n    function invalidMode () {\n      throw new Error(`Invalid auth mode: ${provider_name}`);\n    }\n\n    try {\n      let result;\n      if (provider_name.includes('Email')) {\n        let action;\n        if (provider_name === 'EmailSignin') {\n          action = 'signInWithEmailAndPassword';\n        } else if (provider_name === 'EmailSignup') {\n          action = 'createUserWithEmailAndPassword';\n        } else {\n          invalidMode();\n        }\n\n        debug('Authorizing via email', {action, email});\n        result = await auth[action](email, password)\n          .then((ok)=> {\n            console.log('honk', ok);\n            return ok;\n          })\n          .catch((error)=> {\n            console.error('dat error', error);\n            throw error;\n          });\n\n        if (action === 'createUserWithEmailAndPassword') {\n          debug('Sending session email verification');\n          result = await auth.currentUser.sendEmailVerification();\n        }\n      } else if (dedicated_providers.includes(provider_name)) {\n        const Provider = Firebase.auth[`${provider_name}AuthProvider`];\n        const provider = new Provider();\n        debug('Authorizing via dedicated provider', {provider_name, provider_method});\n        result = await auth[provider_method](provider);\n      } else if (oauth_providers.includes(provider_name)) {\n        const domain = `${provider_name.toLowerCase()}.com`;\n        const provider = new Firebase.auth.OAuthProvider(domain);\n        debug('Authorizing via OAuth provider', {domain, provider_method});\n        result = await auth[provider_method](provider);\n      } else {\n        invalidMode();\n      }\n      return result;\n    } catch (error) {\n      debug('Error authenticating', error);\n      throw error;\n    }\n  }\n\n  function end () {\n    debug('Signing out');\n    return Firebase.auth().signOut();\n  }\n\n  function reload () {\n    // TODO: implement reload\n  }\n\n  let $body;\n  if (loaded) {\n    $body = children({user});\n  } else {\n    $body = (\n      <Loading\n        user={user}\n        error={error}\n        reload={reload}\n      />\n    );\n  }\n\n  return (\n    <SessionContext.Provider\n      value={{\n        loaded,\n        error,\n        user,\n        start,\n        reload,\n        end\n      }}\n    >\n      {$body}\n    </SessionContext.Provider>\n  );\n}\n\nSessionProvider.propTypes = {\n  children: PropTypes.func,\n  client: PropTypes.object,\n  SessionUser: PropTypes.func,\n  Loading: PropTypes.func,\n  popup: PropTypes.bool\n};\n\nconst {Consumer: SessionConsumer} = SessionContext;\n\nfunction useSession () {\n  return useContext(SessionContext);\n}\n\nfunction useSessionUser () {\n  const session = useSession();\n  return session.user;\n}\n\nexport {\n  SessionContext,\n  SessionConsumer,\n  SessionProvider,\n  useSession,\n  useSessionUser\n};\n","import gql from 'graphql-tag';\nimport {ApolloClient} from 'apollo-client';\nimport {setContext} from 'apollo-link-context';\nimport {createHttpLink} from 'apollo-link-http';\nimport {InMemoryCache} from 'apollo-cache-inmemory';\n\nimport debug from './debug';\n\nexport default function getClient ({uri}) {\n  debug(`Getting client with uri ${uri}`);\n\n  const http_link = createHttpLink({uri});\n\n  const auth_link = setContext(async (request, prev_context)=> {\n    const {headers = {}} = prev_context;\n    const token = await getToken();\n    if (token) {\n      debug('Adding auth token to header');\n      headers.authorization = token ? `Bearer ${token}` : '';\n    }\n    return {headers};\n  });\n\n  const link = auth_link.concat(http_link);\n  const cache = new InMemoryCache();\n  const client = new ApolloClient({link, cache});\n\n  async function getToken () {\n    debug('Getting auth token');\n    const query = gql`\n      {\n        token @client\n      }\n    `;\n    const {data} = await client.query({query});\n    return data.token;\n  }\n\n  function setToken (token) {\n    debug('Setting auth token');\n    return client.writeData({data: {token}});\n  }\n\n  function clearToken () {\n    debug('Clearing auth token');\n    return setToken(null);\n  }\n\n  client.setToken = setToken;\n  client.clearToken = clearToken;\n\n  clearToken();\n  return client;\n}\n","export default function getSubdomain (hostname) {\n  const parts = hostname.split('.');\n\n  let last_index = -2;\n  const last = parts[parts.length - 1];\n  const is_localhost = last === 'localhost';\n  if (is_localhost) {\n    last_index = -1;\n  }\n\n  return parts.slice(0, last_index).join('.');\n}\n","const config = {\n  // Parcel requires explicit env vars\n  apiKey: process.env.FIREBASE_API_KEY,\n  authDomain: process.env.FIREBASE_AUTH_DOMAIN,\n  databaseURL: process.env.FIREBASE_DATABASE_URL,\n  projectId: process.env.FIREBASE_PROJECT_ID,\n  storageBucket: process.env.FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.FIREBASE_APP_ID,\n  measurementId: process.env.FIREBASE_MEASUREMENT_ID\n};\n\nexport default config;\n","import * as React from 'react';\nimport {\n  useEffect,\n  useState\n} from 'react';\nimport PropTypes from 'prop-types';\n\nimport debug from './debug';\n\nexport default function PageContainer ({\n  Loading,\n  Error,\n  match,\n  client\n}) {\n  const {params, route} = match;\n  const {page: Page} = route;\n\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [data, setData] = useState(null);\n\n  useEffect(()=> {\n    let unmounted = false;\n    async function runQuery () {\n      if (unmounted) {\n        debug('Skipping unmounted query');\n        return;\n      }\n\n      if (!Page.query) {\n        debug('No query defined');\n        setLoading(false);\n        return;\n      }\n\n      try {\n        const page_query = Page.query(params);\n        debug('Running query', page_query);\n        const {data} = await client.query(page_query);\n        debug('Ran query', data);\n        setData(data);\n      } catch (error) {\n        debug('Error running query', error);\n        setError(error);\n      } finally {\n        debug('Done loading');\n        setLoading(false);\n      }\n    }\n\n    runQuery();\n\n    return ()=> {\n      debug('Unmounting page container');\n      unmounted = true;\n    };\n  }, []);\n\n  let body;\n  if (loading) {\n    body = (\n      <Loading/>\n    );\n  } else if (error) {\n    body = (\n      <Error error={error}/>\n    );\n  } else {\n    body = (\n      <Page\n        params={params}\n        route={route}\n        {...data}\n      />\n    );\n  }\n\n  return body;\n}\n\nPageContainer.propTypes = {\n  Loading: PropTypes.func,\n  Error: PropTypes.func,\n  match: PropTypes.object,\n  client: PropTypes.object\n};\n","import getSubdomain from './getSubdomain';\n\nexport default function subdomainApps (map) {\n  const main = map.find((item)=> item.main);\n  if (!main) {\n    throw new Error('Must set main flag to true on at least one subdomain app');\n  }\n\n  return function getApp () {\n    const {hostname} = window.location;\n    const subdomain = getSubdomain(hostname);\n\n    if (!subdomain) {\n      return main.app;\n    }\n\n    const app = map.find(({subdomains})=> subdomains.includes(subdomain));\n    if (app) {\n      return app.app;\n    } else {\n      return main.app;\n    }\n  };\n}\n","import {useSingleton} from '@hello10/react-hooks';\nimport {Router} from 'groutcho';\n\nclass SingletonRouter extends useSingleton.Singleton {\n  initialize () {\n    this.history = [];\n\n    if (('web' in this.options)) {\n      this.web = this.options.web;\n    } else {\n      this.web = !!(window && window.location && window.history);\n    }\n\n    const {routes, redirects} = this.options;\n    this.router = new Router({routes, redirects});\n    this.router.onGo(this._onGo.bind(this));\n\n    let url = '/';\n    if (this.web) {\n      const {location} = window;\n      const {pathname, search} = location;\n      url = `${pathname}${search}`;\n      window.addEventListener('popstate', this._onPopState.bind(this));\n    }\n\n    return {url};\n  }\n\n  get url () {\n    return this.state.url;\n  }\n\n  match (input) {\n    const match = this.router.match({\n      ...input,\n      url: this.url\n    });\n    const {redirect, url} = match;\n    if (redirect) {\n      this._setUrl(url);\n    }\n    return match;\n  }\n\n  go (args) {\n    this.router.go(args);\n  }\n\n  back () {\n    const last = this.history.pop();\n    if (!last) {\n      return;\n    }\n    this.go(last);\n  }\n\n  _setUrl (url) {\n    const state = {url};\n    this.setState(state);\n    this.history.push(state);\n    if (this.web) {\n      window.history.pushState(state, '', url);\n    }\n  }\n\n  _onGo (new_url) {\n    if (new_url !== this.url) {\n      this._setUrl(new_url);\n      const {onGo} = this.options;\n      if (onGo) {\n        onGo(new_url);\n      }\n    }\n  }\n\n  _onPopState ({state}) {\n    this.setState(state);\n  }\n}\n\nexport default function useRouter (options = {}) {\n  return useSingleton(SingletonRouter, options);\n}\n"],"names":["getGraphQLErrorCode","error","code","get","debug","makeDebug","_catch","body","recover","result","e","then","SessionContext","createContext","finalizer","bind","SessionProvider","client","children","SessionUser","Loading","popup","start","email","password","provider","provider_name","auth","Firebase","provider_method","dedicated_providers","invalidMode","Error","oauth_providers","includes","action","ok","console","log","catch","currentUser","sendEmailVerification","Provider","domain","toLowerCase","OAuthProvider","loaded","setLoaded","useState","setError","user","_setUser","setUser","data","useEffect","unsubscribe","onAuthStateChanged","firebase_user","getIdToken","token","setToken","load","clearToken","end","signOut","reload","$body","React.createElement","propTypes","PropTypes","func","object","bool","Consumer","SessionConsumer","useSession","useContext","useSessionUser","session","getClient","uri","getToken","query","gql","http_link","createHttpLink","auth_link","setContext","request","prev_context","headers","authorization","link","concat","cache","InMemoryCache","ApolloClient","writeData","getSubdomain","hostname","parts","split","last_index","last","length","is_localhost","slice","join","config","apiKey","process","env","FIREBASE_API_KEY","authDomain","FIREBASE_AUTH_DOMAIN","databaseURL","FIREBASE_DATABASE_URL","projectId","FIREBASE_PROJECT_ID","storageBucket","FIREBASE_STORAGE_BUCKET","messagingSenderId","FIREBASE_MESSAGING_SENDER_ID","appId","FIREBASE_APP_ID","measurementId","FIREBASE_MEASUREMENT_ID","PageContainer","match","params","route","page","Page","loading","setLoading","setData","runQuery","unmounted","page_query","subdomainApps","map","main","find","item","getApp","window","location","subdomain","app","subdomains","SingletonRouter","useSingleton","Singleton","initialize","history","options","web","routes","redirects","router","Router","onGo","_onGo","url","pathname","search","addEventListener","_onPopState","state","input","redirect","_setUrl","go","args","back","pop","setState","push","pushState","new_url","useRouter"],"mappings":"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"}