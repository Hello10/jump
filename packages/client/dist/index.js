function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}require("babel-polyfill");var r=require("react"),n=e(require("prop-types")),t=e(require("firebase/app"));require("firebase/auth");var o=e(require("lodash.get")),i=e(require("graphql-tag")),u=require("apollo-client"),s=require("apollo-link-context"),a=require("apollo-link-http"),c=require("apollo-cache-inmemory");function l(e){var r=o(e,"graphQLErrors[0].extensions.code",null);return r||(r=o(e,"networkError.result.errors[0].extensions.code",null)),r}var f=r.createContext();function v(e){var n,o=e.client,i=e.children,u=e.SessionUser,s=e.Loading,a=e.popup,c=void 0===a||a,v=r.useState(!1),p=v[0],d=v[1],m=r.useState(null),E=m[0],P=m[1],S=r.useState(new u(null)),g=S[0],A=S[1];function y(e){var r=new u(e);A(r)}function I(){}return r.useEffect(function(){var e=t.auth().onAuthStateChanged(function(e){try{return Promise.resolve(function(r,n){try{var t=function(r,n){try{var t=function(){var r=function(){if(e)return Promise.resolve(e.getIdToken(!0)).then(function(r){return o.setToken(r),Promise.resolve(u.load({client:o,token:r,firebase_user:e})).then(function(e){y(e)})});o.clearToken(),y(null)}();if(r&&r.then)return r.then(function(){})}()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}(0,function(e){var r=l(e);P(r||"Session error")})}catch(e){return n(!0,e)}return t&&t.then?t.then(n.bind(null,!1),n.bind(null,!0)):n(!1,t)}(0,function(e,r){if(d(!0),e)throw r;return r}))}catch(e){return Promise.reject(e)}});return function(){e()}},[]),n=p?i({user:g}):h(s,{user:g,error:E,reload:I}),h(f.Provider,{value:{loaded:p,error:E,user:g,start:function(e){var r=e.email,n=e.password,o=e.provider;try{var i,u=t.auth(),s=c?"signInWithPopup":"signInWithRedirect",a=["Google","Facebook","Twitter","Github"],l=["Yahoo","Microsoft","Apple"],f=function(){var e;if(o.includes("Email"))return"EmailSignin"===o?e="signInWithEmailAndPassword":"EmailSignup"===o&&(e="createUserWithEmailAndPassword"),Promise.resolve(u[e](r,n)).then(function(r){i=r;var n=function(){if("createUserWithEmailAndPassword"===e)return Promise.resolve(u.currentUser.sendEmailVerification()).then(function(e){i=e})}();if(n&&n.then)return n.then(function(){})});var c=function(){if(a.includes(o)){var e=new(0,t.auth[o+"AuthProvider"]);return Promise.resolve(u[s](e)).then(function(e){i=e})}var r=function(){if(l.includes(o)){var e=o.toLowerCase()+".com",r=new t.auth.OAuthProvider(e);return Promise.resolve(u[s](r)).then(function(e){i=e})}}();if(r&&r.then)return r.then(function(){})}();return c&&c.then?c.then(function(){}):void 0}();return Promise.resolve(f&&f.then?f.then(function(){return i}):i)}catch(e){return Promise.reject(e)}},reload:I,end:function(){return t.auth().signOut()}}},n)}v.propTypes={children:n.func,client:n.object,SessionUser:n.func,Loading:n.func,popup:n.bool};var p=f.Consumer;function d(){return r.useContext(f)}function m(){return(m=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function E(){var e,r,n=(e=["\n      {\n        token @client\n      }\n    "],r||(r=e.slice(0)),e.raw=r,e);return E=function(){return n},n}function P(e){var n=e.Loading,t=e.Error,o=e.match,i=e.client,u=o.params,s=o.route,a=s.page,c=r.useState(!0),l=c[0],f=c[1],v=r.useState(null),p=v[0],d=v[1],E=r.useState(null),P=E[0],S=E[1];return r.useEffect(function(){var e=!1;return function(){try{if(e)return Promise.resolve();if(!a.query)return f(!1),Promise.resolve();var r=function(e,r){try{var n=function(e,r){try{var n=(t=a.query(u),Promise.resolve(i.query(t)).then(function(e){S(e.data)}))}catch(e){return r(e)}var t;return n&&n.then?n.then(void 0,r):n}(0,function(e){d(e)})}catch(e){return r(!0,e)}return n&&n.then?n.then(r.bind(null,!1),r.bind(null,!0)):r(!1,n)}(0,function(e,r){if(f(!1),e)throw r;return r});Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(),function(){e=!0}},[]),l?h(n,null):p?h(t,{error:p}):h(a,m({params:u,route:s},P))}P.propTypes={Loading:n.func,Error:n.func,match:n.object,client:n.object};var S={apiKey:process.env.FIREBASE_API_KEY,authDomain:process.env.FIREBASE_AUTH_DOMAIN,databaseURL:process.env.FIREBASE_DATABASE_URL,projectId:process.env.FIREBASE_PROJECT_ID,storageBucket:process.env.FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.FIREBASE_MESSAGING_SENDER_ID,appId:process.env.FIREBASE_APP_ID,measurementId:process.env.FIREBASE_MEASUREMENT_ID};exports.PageContainer=P,exports.SessionConsumer=p,exports.SessionContext=f,exports.SessionProvider=v,exports.firebaseConfig=S,exports.getClient=function(e){var r=a.createHttpLink({uri:e.uri}),n=s.setContext(function(e,r){try{var n=r.headers,t=void 0===n?{}:n;return Promise.resolve(function(){try{var e=i(E());return Promise.resolve(o.query({query:e})).then(function(e){return e.data.token})}catch(e){return Promise.reject(e)}}()).then(function(e){return e&&(t.authorization=e?"Bearer "+e:""),{headers:t}})}catch(e){return Promise.reject(e)}}).concat(r),t=new c.InMemoryCache,o=new u.ApolloClient({link:n,cache:t});function l(e){return o.writeData({data:{token:e}})}function f(){return l(null)}return o.setToken=l,o.clearToken=f,f(),o},exports.getGraphQLErrorCode=l,exports.useSession=d,exports.useSessionUser=function(){return d().user};
//# sourceMappingURL=index.js.map
