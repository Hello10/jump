{"version":3,"file":"index.umd.js","sources":["../src/logger.js","../src/PageContainer.js","../src/ApplicationContainer.js","../src/Session.js","../src/FirebaseSession.js","../src/getClient.js","../src/getGraphQLErrorCode.js","../src/getSubdomain.js","../src/subdomainApps.js","../src/Router.js"],"sourcesContent":["import Logger from '@hello10/logger';\n\nconst logger = new Logger('jump');\n\nexport default logger;\n","import * as React from 'react';\nimport {\n  useEffect,\n  useState\n} from 'react';\nimport PropTypes from 'prop-types';\n\nimport base_logger from './logger';\n\nexport default function PageContainer ({\n  Loading,\n  Error,\n  match,\n  client\n}) {\n  const {params, route} = match;\n  const {page: Page, name} = route;\n\n  const logger = base_logger.child('PageContainer');\n\n  const [last_match, setLastMatch] = useState(match);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [data, setData] = useState(null);\n\n  // Check whether the page changed\n  if (match !== last_match) {\n    logger.debug('Resetting for new page', {last_match, match});\n    setLoading(true);\n    setError(null);\n    setData(null);\n    setLastMatch(match);\n  }\n\n  logger.debug('Rendering page container', {match, loading, error, data});\n\n  useEffect(()=> {\n    let unmounted = false;\n    async function runQuery () {\n      if (unmounted) {\n        logger.debug('Skip unmounted query');\n        return;\n      }\n\n      try {\n        const page_query = Page.query(params);\n        logger.debug('Running query', page_query);\n        const {data} = await client.query(page_query);\n        logger.debug('Ran query', data);\n        setData(data);\n      } catch (error) {\n        logger.error('Error running query', error);\n        setError(error);\n      } finally {\n        logger.debug('Done loading');\n        setLoading(false);\n      }\n    }\n\n    if (Page.query) {\n      runQuery();\n    } else {\n      setLoading(false);\n    }\n\n    return ()=> {\n      logger.debug('Unmounting page container');\n      unmounted = true;\n    };\n  }, [match]);\n\n  const props = {Page, match, route, params};\n\n  if (loading) {\n    logger.debug(`Rendering loading for ${name}`);\n    return (\n      <Loading {...props} />\n    );\n  } else if (error) {\n    logger.debug(`Rendering error for ${name}`);\n    return (\n      <Error\n        error={error}\n        {...props}\n      />\n    );\n  } else {\n    logger.debug(`Rendering loaded for ${name}`);\n    return (\n      <Page\n        match={match}\n        params={params}\n        route={route}\n        {...data}\n      />\n    );\n  }\n}\n\nPageContainer.propTypes = {\n  Loading: PropTypes.func,\n  Error: PropTypes.func,\n  match: PropTypes.object,\n  client: PropTypes.object\n};\n","import React, {useEffect, useState} from 'react';\nimport PropTypes from 'prop-types';\n\nimport base_logger from './logger';\nimport PageContainer from './PageContainer';\n\nexport default function ApplicationContainer ({\n  ApplicationLoading,\n  Container,\n  PageLoading,\n  PageError,\n  client,\n  useRouter,\n  useSession,\n  ...props\n}) {\n  const logger = base_logger.child('ApplicationContainer');\n  logger.debug('Rendering ApplicationContainer');\n\n  const router = useRouter();\n  const [match, setMatch] = useState(null);\n  const session = useSession();\n  const {user} = session;\n\n  useEffect(()=> {\n    logger.debug('Loading session');\n    session.load();\n    return ()=> {\n      logger.debug('Unloading session');\n      session.unload();\n    };\n  }, []);\n\n  useEffect(()=> {\n    logger.debug('Running router', {user});\n    if (!session.loaded) {\n      return;\n    }\n    const match = router.match({user});\n    if (match) {\n      const {route, redirect} = match;\n      if (redirect) {\n        let msg = 'Got redirect';\n        const name = route?.name;\n        if (name) {\n          msg = `${msg} to ${name}`;\n        }\n        logger.info(msg, {match});\n      }\n      setMatch(match);\n    }\n  }, [user, router.url]);\n\n  if (session.loaded && match) {\n    return (\n      <Container\n        match={match}\n      >\n        <PageContainer\n          Loading={PageLoading}\n          Error={PageError}\n          match={match}\n          client={client}\n          {...props}\n        />\n      </Container>\n    );\n  } else {\n    return (\n      <ApplicationLoading\n        error={session.error || router.error}\n        user={user}\n        {...props}\n      />\n    );\n  }\n}\n\nApplicationContainer.whyDidYouRender = {\n  logOnDifferentValues: true\n};\n\nApplicationContainer.propTypes = {\n  ApplicationLoading: PropTypes.func,\n  Container: PropTypes.func,\n  PageLoading: PropTypes.func,\n  PageError: PropTypes.func,\n  client: PropTypes.object,\n  useRouter: PropTypes.func,\n  useSession: PropTypes.func\n};\n","import {useSingleton} from '@hello10/react-hooks';\n\nimport logger from './logger';\n\nexport default class Session extends useSingleton.Singleton {\n  initialize () {\n    const {\n      SessionUser,\n      client,\n      shouldEndSessionOnError = ()=> {\n        return true;\n      }\n    } = this.options;\n\n    SessionUser.client = client;\n    const user = new SessionUser();\n\n    this.SessionUser = SessionUser;\n    this.client = client;\n    this.shouldEndSessionOnError = shouldEndSessionOnError;\n\n    this.logger = logger.child({\n      name: 'Session',\n      user\n    });\n\n    return {\n      user,\n      changing: false,\n      loaded: false,\n      error: null\n    };\n  }\n\n  get user () {\n    return this.state.user;\n  }\n\n  get changing () {\n    return this.state.changing;\n  }\n\n  get loaded () {\n    return this.state.loaded;\n  }\n\n  get error () {\n    return this.state.error;\n  }\n\n  get load_error () {\n    return this.loaded ? null : this.error;\n  }\n\n  async load () {\n    this.logger.debug('Loading session');\n    return this._change(async ()=> {\n      await this.client.loadAuth();\n      const user = await this.SessionUser.load();\n      this.logger.debug('Session loaded', {user});\n      return {\n        user,\n        loaded: true\n      };\n    });\n  }\n\n  unload () {}\n\n  start (args) {\n    this.logger.debug('Starting session');\n    return this._change(async ()=> {\n      const {user, auth} = await this.SessionUser.start(args);\n      this.logger.debug('Session started, setting auth', {user});\n      await this.client.setAuth(auth);\n      return {user};\n    });\n  }\n\n  refresh () {\n    const {SessionUser} = this;\n    if (SessionUser.refresh) {\n      this.logger.debug('No refresh method defined on SessionUser');\n      return null;\n    }\n\n    this.logger.debug('Refreshing session');\n    return this._change(async ()=> {\n      const {client} = this;\n      const client_auth = await client.getAuth();\n      const data = await SessionUser.refresh(client_auth);\n      const {user, auth} = data;\n      this.logger.debug('Session refreshed, setting auth', {user});\n      await client.setAuth(auth);\n      return {user};\n    });\n  }\n\n  end (args) {\n    const {SessionUser} = this;\n    this.logger.debug('Ending session');\n    return this._change(async ()=> {\n      try {\n        await SessionUser.end(args);\n        this.logger.debug('Session ended');\n      } catch (error) {\n        this.logger.error('Error ending sesssion', error);\n      }\n      await this.client.clearAuth();\n      const user = new SessionUser();\n      return {user};\n    });\n  }\n\n  async _change (action) {\n    if (!this.changing) {\n      this.setState({changing: true});\n    }\n\n    try {\n      const state = await action();\n      this.setState({\n        changing: false,\n        error: null,\n        ...state\n      });\n    } catch (error) {\n      this.logger.error('Session error', {error});\n      let {user} = this;\n      if (this.shouldEndSessionOnError(error)) {\n        this.logger.debug('Clearing session on error');\n        await this.client.clearAuth();\n        user = null;\n      }\n      this.setState({\n        changing: false,\n        user,\n        error\n      });\n    }\n  }\n}\n","import Session from './Session';\n\nexport default class FirebaseSession extends Session {\n  get auth () {\n    return this.options.auth;\n  }\n\n  get Firebase () {\n    return this.options.Firebase;\n  }\n\n  async load () {\n    this.logger.debug('Loading session');\n\n    this.setState({changing: true});\n\n    const {SessionUser, client} = this;\n    const auth = this.Firebase.auth();\n    this.unsubscribe = auth.onAuthStateChanged(async (firebase_user)=> {\n      this.logger.debug('Firebase auth state changed', {firebase_user});\n      await this._change(async ()=> {\n        let user;\n        if (firebase_user) {\n          this.logger.debug('Getting firebase user token');\n          const token = await firebase_user.getIdToken(true);\n          client.setAuth({token});\n          this.logger.debug('Loading session user');\n          user = await SessionUser.load({client, token, firebase_user});\n        } else {\n          this.logger.debug('No firebase user clearing session');\n          await client.clearAuth();\n          user = new SessionUser();\n        }\n        return {user, loaded: true};\n      });\n    });\n  }\n\n  async unload () {\n    this.logger.debug('Unsubscribing from Firebase auth listener');\n    this.unsubscribe();\n  }\n\n  async start ({\n    email,\n    password,\n    provider: provider_name,\n    popup = false\n  }) {\n    const provider_method = popup ? 'signInWithPopup' : 'signInWithRedirect';\n    const dedicated_providers = ['Google', 'Facebook', 'Twitter', 'Github'];\n    const oauth_providers = ['Yahoo', 'Microsoft', 'Apple'];\n\n    function invalidMode () {\n      throw new Error(`Invalid auth mode: ${provider_name}`);\n    }\n\n    const {Firebase, auth} = this;\n\n    try {\n      let credential;\n      if (provider_name.includes('Email')) {\n        if (provider_name === 'EmailSignin') {\n          this.logger.debug('Signing in with email', {email});\n          credential = await auth.signInWithEmailAndPassword(email, password);\n        } else if (provider_name === 'EmailSignup') {\n          this.logger.debug('Signing up with email', {email});\n          credential = await auth.createUserWithEmailAndPassword(email, password);\n          this.logger.debug('Sending session email verification');\n          await credential.user.sendEmailVerification();\n        } else {\n          invalidMode();\n        }\n      } else if (dedicated_providers.includes(provider_name)) {\n        const Provider = Firebase.auth[`${provider_name}AuthProvider`];\n        const provider = new Provider();\n        this.logger.debug('Authorizing via dedicated provider', {provider_name, provider_method});\n        credential = await auth[provider_method](provider);\n      } else if (oauth_providers.includes(provider_name)) {\n        const domain = `${provider_name.toLowerCase()}.com`;\n        const provider = new Firebase.auth.OAuthProvider(domain);\n        this.logger.debug('Authorizing via OAuth provider', {domain, provider_method});\n        credential = await auth[provider_method](provider);\n      } else {\n        invalidMode();\n      }\n      return credential;\n    } catch (error) {\n      this.logger.debug('Error authenticating', error);\n      throw error;\n    }\n  }\n\n  async end () {\n    this.setState({changing: true});\n    return this.auth.signOut();\n  }\n}\n","import gql from 'graphql-tag';\nimport {ApolloClient} from 'apollo-client';\nimport {setContext} from 'apollo-link-context';\nimport {createHttpLink} from 'apollo-link-http';\nimport {InMemoryCache} from 'apollo-cache-inmemory';\n\nimport base_logger from './logger';\n\nconst NO_SESSION = {\n  token: null,\n  refresh_token: null\n};\n\nexport default function getClient ({uri, storage, storage_key = 'JUMP_AUTH'}) {\n  const logger = base_logger.child({name: 'getClient', uri});\n\n  logger.info('Getting client');\n\n  const http_link = createHttpLink({uri});\n\n  const auth_link = setContext(async (request, prev_context)=> {\n    const {headers = {}} = prev_context;\n    const {token} = await readClientAuth();\n    if (token) {\n      logger.debug('Adding auth token to header');\n      headers.authorization = token ? `Bearer ${token}` : '';\n    }\n    return {headers};\n  });\n\n  const link = auth_link.concat(http_link);\n  const cache = new InMemoryCache();\n  const client = new ApolloClient({link, cache});\n  writeClientAuth(NO_SESSION);\n\n  async function readClientAuth () {\n    logger.debug('Getting client auth');\n    const query = gql`\n      {\n        token @client\n        refresh_token @client\n      }\n    `;\n    const {data} = await client.query({query});\n    return data;\n  }\n\n  function writeClientAuth (auth) {\n    logger.debug('Setting client auth');\n    return client.writeData({data: auth});\n  }\n\n  function writeAuthToStorage (auth) {\n    logger.debug('Writing auth to storage');\n    const json = JSON.stringify(auth);\n    return storage.setItem(storage_key, json);\n  }\n\n  async function readAuthFromStorage () {\n    logger.debug('Reading auth from storage');\n    let auth;\n    try {\n      const json = await storage.getItem(storage_key);\n      auth = JSON.parse(json) || {};\n    } catch (error) {\n      auth = {};\n    }\n    return auth;\n  }\n\n  async function setAuth (auth) {\n    logger.debug('Setting session auth');\n    if (storage) {\n      await writeAuthToStorage(auth);\n    }\n    return writeClientAuth(auth);\n  }\n\n  async function loadAuth () {\n    if (!storage) {\n      throw new Error('No storage specified to load auth from');\n    }\n    logger.debug('Loading session auth');\n    const auth = await readAuthFromStorage();\n    return writeClientAuth(auth);\n  }\n\n  async function clearAuth () {\n    logger.debug('Clearing session auth');\n    if (storage) {\n      await writeAuthToStorage(NO_SESSION);\n    }\n    return writeClientAuth(NO_SESSION);\n  }\n\n  client.setAuth = setAuth;\n  client.loadAuth = loadAuth;\n  client.clearAuth = clearAuth;\n\n  return client;\n}\n","import get from 'lodash.get';\n\nexport default function getGraphQLErrorCode (error) {\n  let code = get(error, 'graphQLErrors[0].extensions.code', null);\n  if (!code) {\n    code = get(error, 'networkError.result.errors[0].extensions.code', null);\n  }\n  return code;\n}\n","export default function getSubdomain (hostname) {\n  const parts = hostname.split('.');\n\n  let last_index = -2;\n  const last = parts[parts.length - 1];\n  const is_localhost = last === 'localhost';\n  if (is_localhost) {\n    last_index = -1;\n  }\n\n  return parts.slice(0, last_index).join('.');\n}\n","import getSubdomain from './getSubdomain';\n\nexport default function subdomainApps (map) {\n  const main = map.find((item)=> item.main);\n  if (!main) {\n    throw new Error('Must set main flag to true on at least one subdomain app');\n  }\n\n  return function getApp () {\n    const {hostname} = window.location;\n    const subdomain = getSubdomain(hostname);\n\n    if (!subdomain) {\n      return main.app;\n    }\n\n    const app = map.find(({subdomains})=> subdomains.includes(subdomain));\n    if (app) {\n      return app.app;\n    } else {\n      return main.app;\n    }\n  };\n}\n","import {useSingleton} from '@hello10/react-hooks';\nimport Groutcho from 'groutcho';\n\nimport logger from './logger';\n\nexport default class Router extends useSingleton.Singleton {\n  initialize () {\n    this.history = [];\n\n    if (('web' in this.options)) {\n      this.web = this.options.web;\n    } else {\n      this.web = !!(window && window.location && window.history);\n    }\n\n    const {routes, redirects} = this.options;\n    this.router = new Groutcho.Router({routes, redirects});\n    this.router.onGo(this._onGo.bind(this));\n\n    let url = '/';\n    if (this.web) {\n      const {location} = window;\n      const {pathname, search} = location;\n      url = `${pathname}${search}`;\n      window.addEventListener('popstate', this._onPopState.bind(this));\n    }\n\n    this.logger = logger.child({\n      name: 'Router',\n      web: this.web\n    });\n\n    this.logger.debug('Initializing router');\n\n    return {url};\n  }\n\n  get url () {\n    return this.state.url;\n  }\n\n  get error () {\n    return this.state.error;\n  }\n\n  match (input) {\n    this.input = input;\n    const match = this.router.match({\n      ...input,\n      url: this.url\n    });\n    this.logger.debug('Router match', {match, input});\n    if (match) {\n      if (match.redirect) {\n        this._setUrl(match.url);\n      }\n    } else {\n      const error = new Error('Router could not match url');\n      this.setState({error});\n    }\n    return match;\n  }\n\n  go (args) {\n    args = {\n      ...this.input,\n      ...this.router._normalizeInput(args)\n    };\n    this.logger.debug('Router go called', {args, url: this.url});\n    this.router.go(args);\n  }\n\n  back () {\n    const last = this.history.pop();\n    if (!last) {\n      return;\n    }\n    this.go(last);\n  }\n\n  _setUrl (url) {\n    this.logger.debug('Setting router url', url);\n    if (url !== this.url) {\n      const state = {url};\n      this.setState(state);\n      this.history.push(state);\n      if (this.web) {\n        window.history.pushState(state, '', url);\n      }\n    }\n  }\n\n  _onGo (match) {\n    this.logger.debug('Router onGo called', {match, current: this.url});\n    const {url} = match;\n    if (url !== this.url) {\n      this._setUrl(url);\n      const {onGo} = this.options;\n      if (onGo) {\n        onGo(match);\n      }\n    }\n  }\n\n  _onPopState ({state}) {\n    this.setState(state);\n  }\n}\n"],"names":["logger","Logger","body","recover","result","e","then","finalizer","bind","PageContainer","Loading","Error","match","client","params","route","page","Page","name","base_logger","child","last_match","setLastMatch","useState","loading","setLoading","error","setError","data","setData","debug","useEffect","runQuery","unmounted","page_query","query","props","React.createElement","propTypes","PropTypes","func","object","ApplicationContainer","ApplicationLoading","Container","PageLoading","PageError","useRouter","useSession","router","setMatch","session","user","load","unload","loaded","redirect","msg","info","url","React","whyDidYouRender","logOnDifferentValues","Session","useSingleton","Singleton","initialize","SessionUser","shouldEndSessionOnError","options","changing","state","load_error","_change","loadAuth","start","args","auth","setAuth","refresh","getAuth","client_auth","end","clearAuth","action","setState","FirebaseSession","Firebase","unsubscribe","onAuthStateChanged","firebase_user","getIdToken","token","email","password","provider","provider_name","popup","provider_method","dedicated_providers","invalidMode","oauth_providers","credential","includes","signInWithEmailAndPassword","createUserWithEmailAndPassword","sendEmailVerification","Provider","domain","toLowerCase","OAuthProvider","signOut","_catch","NO_SESSION","refresh_token","getClient","uri","storage","storage_key","writeClientAuth","writeAuthToStorage","readAuthFromStorage","getItem","json","JSON","parse","readClientAuth","gql","http_link","createHttpLink","auth_link","setContext","request","prev_context","headers","authorization","link","concat","cache","InMemoryCache","ApolloClient","writeData","stringify","setItem","getGraphQLErrorCode","code","get","getSubdomain","hostname","parts","split","last_index","last","length","is_localhost","slice","join","subdomainApps","map","main","find","item","getApp","window","location","subdomain","app","subdomains","Router","history","web","routes","redirects","Groutcho","onGo","_onGo","pathname","search","addEventListener","_onPopState","input","_setUrl","go","_normalizeInput","back","pop","push","pushState","current"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAEA,MAAMA,MAAM,GAAG,IAAIC,MAAJ,CAAW,MAAX,CAAf;;ECgjBO,gBAAgBC,IAAhB,EAAsBC,OAAtB,EAA+B;EACrC,MAAI;EACH,QAAIC,MAAM,GAAGF,IAAI,EAAjB;EACA,GAFD,CAEE,OAAMG,CAAN,EAAS;EACV,WAAOF,OAAO,CAACE,CAAD,CAAd;EACA;;EACD,MAAID,MAAM,IAAIA,MAAM,CAACE,IAArB,EAA2B;EAC1B,WAAOF,MAAM,CAACE,IAAP,CAAY,KAAK,CAAjB,EAAoBH,OAApB,CAAP;EACA;;EACD,SAAOC,MAAP;EACA;;EAGM,0BAA0BF,IAA1B,EAAgCK,SAAhC,EAA2C;EACjD,MAAI;EACH,QAAIH,MAAM,GAAGF,IAAI,EAAjB;EACA,GAFD,CAEE,OAAOG,CAAP,EAAU;EACX,WAAOE,SAAS,CAAC,IAAD,EAAOF,CAAP,CAAhB;EACA;;EACD,MAAID,MAAM,IAAIA,MAAM,CAACE,IAArB,EAA2B;EAC1B,WAAOF,MAAM,CAACE,IAAP,CAAYC,SAAS,CAACC,IAAV,CAAe,IAAf,EAAqB,KAArB,CAAZ,EAAyCD,SAAS,CAACC,IAAV,CAAe,IAAf,EAAqB,IAArB,CAAzC,CAAP;EACA;;EACD,SAAOD,SAAS,CAAC,KAAD,EAAQH,MAAR,CAAhB;EACA;;AAhkBD,EAAe,SAASK,aAAT,CAAwB;EACrCC,EAAAA,OADqC;EAErCC,EAAAA,KAFqC;EAGrCC,EAAAA,KAHqC;EAIrCC,EAAAA;EAJqC,CAAxB,EAKZ;EACD,QAAM;EAACC,IAAAA,MAAD;EAASC,IAAAA;EAAT,MAAkBH,KAAxB;EACA,QAAM;EAACI,IAAAA,IAAI,EAAEC,IAAP;EAAaC,IAAAA;EAAb,MAAqBH,KAA3B;EAEA,QAAMf,QAAM,GAAGmB,MAAW,CAACC,KAAZ,CAAkB,eAAlB,CAAf;EAEA,QAAM,CAACC,UAAD,EAAaC,YAAb,IAA6BC,cAAQ,CAACX,KAAD,CAA3C;EACA,QAAM,CAACY,OAAD,EAAUC,UAAV,IAAwBF,cAAQ,CAAC,IAAD,CAAtC;EACA,QAAM,CAACG,KAAD,EAAQC,QAAR,IAAoBJ,cAAQ,CAAC,IAAD,CAAlC;EACA,QAAM,CAACK,IAAD,EAAOC,OAAP,IAAkBN,cAAQ,CAAC,IAAD,CAAhC;;EAGA,MAAIX,KAAK,KAAKS,UAAd,EAA0B;EACxBrB,IAAAA,QAAM,CAAC8B,KAAP,CAAa,wBAAb,EAAuC;EAACT,MAAAA,UAAD;EAAaT,MAAAA;EAAb,KAAvC;EACAa,IAAAA,UAAU,CAAC,IAAD,CAAV;EACAE,IAAAA,QAAQ,CAAC,IAAD,CAAR;EACAE,IAAAA,OAAO,CAAC,IAAD,CAAP;EACAP,IAAAA,YAAY,CAACV,KAAD,CAAZ;EACD;;EAEDZ,EAAAA,QAAM,CAAC8B,KAAP,CAAa,0BAAb,EAAyC;EAAClB,IAAAA,KAAD;EAAQY,IAAAA,OAAR;EAAiBE,IAAAA,KAAjB;EAAwBE,IAAAA;EAAxB,GAAzC;EAEAG,EAAAA,eAAS,CAAC,MAAK;EAAA,UAEEC,QAFF;EAAA,UAEc;EACzB,YAAIC,SAAJ,EAAe;EACbjC,UAAAA,QAAM,CAAC8B,KAAP,CAAa,sBAAb;EACA;EACD;;EAJwB;EAAA,oCAMrB;EACF,kBAAMI,UAAU,GAAGjB,IAAI,CAACkB,KAAL,CAAWrB,MAAX,CAAnB;EACAd,YAAAA,QAAM,CAAC8B,KAAP,CAAa,eAAb,EAA8BI,UAA9B;EAFE,mCAGmBrB,MAAM,CAACsB,KAAP,CAAaD,UAAb,CAHnB,iBAGI;EAACN,cAAAA;EAAD,aAHJ;EAIF5B,cAAAA,QAAM,CAAC8B,KAAP,CAAa,WAAb,EAA0BF,IAA1B;EACAC,cAAAA,OAAO,CAACD,IAAD,CAAP;EALE;EAMH,WAZwB,YAYhBF,KAZgB,EAYT;EACd1B,YAAAA,QAAM,CAAC0B,KAAP,CAAa,qBAAb,EAAoCA,KAApC;EACAC,YAAAA,QAAQ,CAACD,KAAD,CAAR;EACD,WAfwB;EAAA;EAgBvB1B,UAAAA,QAAM,CAAC8B,KAAP,CAAa,cAAb;EACAL,UAAAA,UAAU,CAAC,KAAD,CAAV;EAjBuB;EAAA;EAAA;;EAAA;EAmB1B,OArBY;EAAA;EAAA;EAAA;;EACb,QAAIQ,SAAS,GAAG,KAAhB;;EAsBA,QAAIhB,IAAI,CAACkB,KAAT,EAAgB;EACdH,MAAAA,QAAQ;EACT,KAFD,MAEO;EACLP,MAAAA,UAAU,CAAC,KAAD,CAAV;EACD;;EAED,WAAO,MAAK;EACVzB,MAAAA,QAAM,CAAC8B,KAAP,CAAa,2BAAb;EACAG,MAAAA,SAAS,GAAG,IAAZ;EACD,KAHD;EAID,GAjCQ,EAiCN,CAACrB,KAAD,CAjCM,CAAT;EAmCA,QAAMwB,KAAK,GAAG;EAACnB,IAAAA,IAAD;EAAOL,IAAAA,KAAP;EAAcG,IAAAA,KAAd;EAAqBD,IAAAA;EAArB,GAAd;;EAEA,MAAIU,OAAJ,EAAa;EACXxB,IAAAA,QAAM,CAAC8B,KAAP,CAAc,yBAAwBZ,IAAK,EAA3C;EACA,wBACEmB,oBAAC,OAAD,EAAaD,KAAb,CADF;EAGD,GALD,MAKO,IAAIV,KAAJ,EAAW;EAChB1B,IAAAA,QAAM,CAAC8B,KAAP,CAAc,uBAAsBZ,IAAK,EAAzC;EACA,wBACEmB,oBAAC,KAAD;EACE,MAAA,KAAK,EAAEX;EADT,OAEMU,KAFN,EADF;EAMD,GARM,MAQA;EACLpC,IAAAA,QAAM,CAAC8B,KAAP,CAAc,wBAAuBZ,IAAK,EAA1C;EACA,wBACEmB,oBAAC,IAAD;EACE,MAAA,KAAK,EAAEzB,KADT;EAEE,MAAA,MAAM,EAAEE,MAFV;EAGE,MAAA,KAAK,EAAEC;EAHT,OAIMa,IAJN,EADF;EAQD;EACF;EAEDnB,aAAa,CAAC6B,SAAd,GAA0B;EACxB5B,EAAAA,OAAO,EAAE6B,SAAS,CAACC,IADK;EAExB7B,EAAAA,KAAK,EAAE4B,SAAS,CAACC,IAFO;EAGxB5B,EAAAA,KAAK,EAAE2B,SAAS,CAACE,MAHO;EAIxB5B,EAAAA,MAAM,EAAE0B,SAAS,CAACE;EAJM,CAA1B;;EC7Fe,SAASC,oBAAT,OASZ;EAAA,MAT2C;EAC5CC,IAAAA,kBAD4C;EAE5CC,IAAAA,SAF4C;EAG5CC,IAAAA,WAH4C;EAI5CC,IAAAA,SAJ4C;EAK5CjC,IAAAA,MAL4C;EAM5CkC,IAAAA,SAN4C;EAO5CC,IAAAA;EAP4C,GAS3C;EAAA,MADEZ,KACF;;EACD,QAAMpC,QAAM,GAAGmB,MAAW,CAACC,KAAZ,CAAkB,sBAAlB,CAAf;EACApB,EAAAA,QAAM,CAAC8B,KAAP,CAAa,gCAAb;EAEA,QAAMmB,MAAM,GAAGF,SAAS,EAAxB;EACA,QAAM,CAACnC,KAAD,EAAQsC,QAAR,IAAoB3B,cAAQ,CAAC,IAAD,CAAlC;EACA,QAAM4B,OAAO,GAAGH,UAAU,EAA1B;EACA,QAAM;EAACI,IAAAA;EAAD,MAASD,OAAf;EAEApB,EAAAA,eAAS,CAAC,MAAK;EACb/B,IAAAA,QAAM,CAAC8B,KAAP,CAAa,iBAAb;EACAqB,IAAAA,OAAO,CAACE,IAAR;EACA,WAAO,MAAK;EACVrD,MAAAA,QAAM,CAAC8B,KAAP,CAAa,mBAAb;EACAqB,MAAAA,OAAO,CAACG,MAAR;EACD,KAHD;EAID,GAPQ,EAON,EAPM,CAAT;EASAvB,EAAAA,eAAS,CAAC,MAAK;EACb/B,IAAAA,QAAM,CAAC8B,KAAP,CAAa,gBAAb,EAA+B;EAACsB,MAAAA;EAAD,KAA/B;;EACA,QAAI,CAACD,OAAO,CAACI,MAAb,EAAqB;EACnB;EACD;;EACD,UAAM3C,KAAK,GAAGqC,MAAM,CAACrC,KAAP,CAAa;EAACwC,MAAAA;EAAD,KAAb,CAAd;;EACA,QAAIxC,KAAJ,EAAW;EACT,YAAM;EAACG,QAAAA,KAAD;EAAQyC,QAAAA;EAAR,UAAoB5C,KAA1B;;EACA,UAAI4C,QAAJ,EAAc;EACZ,YAAIC,GAAG,GAAG,cAAV;EACA,cAAMvC,IAAI,GAAGH,KAAH,oBAAGA,KAAK,CAAEG,IAApB;;EACA,YAAIA,IAAJ,EAAU;EACRuC,UAAAA,GAAG,GAAI,GAAEA,GAAI,OAAMvC,IAAK,EAAxB;EACD;;EACDlB,QAAAA,QAAM,CAAC0D,IAAP,CAAYD,GAAZ,EAAiB;EAAC7C,UAAAA;EAAD,SAAjB;EACD;;EACDsC,MAAAA,QAAQ,CAACtC,KAAD,CAAR;EACD;EACF,GAlBQ,EAkBN,CAACwC,IAAD,EAAOH,MAAM,CAACU,GAAd,CAlBM,CAAT;;EAoBA,MAAIR,OAAO,CAACI,MAAR,IAAkB3C,KAAtB,EAA6B;EAC3B,wBACEgD,6BAAC,SAAD;EACE,MAAA,KAAK,EAAEhD;EADT,oBAGEgD,6BAAC,aAAD;EACE,MAAA,OAAO,EAAEf,WADX;EAEE,MAAA,KAAK,EAAEC,SAFT;EAGE,MAAA,KAAK,EAAElC,KAHT;EAIE,MAAA,MAAM,EAAEC;EAJV,OAKMuB,KALN,EAHF,CADF;EAaD,GAdD,MAcO;EACL,wBACEwB,6BAAC,kBAAD;EACE,MAAA,KAAK,EAAET,OAAO,CAACzB,KAAR,IAAiBuB,MAAM,CAACvB,KADjC;EAEE,MAAA,IAAI,EAAE0B;EAFR,OAGMhB,KAHN,EADF;EAOD;EACF;EAEDM,oBAAoB,CAACmB,eAArB,GAAuC;EACrCC,EAAAA,oBAAoB,EAAE;EADe,CAAvC;EAIApB,oBAAoB,CAACJ,SAArB,GAAiC;EAC/BK,EAAAA,kBAAkB,EAAEJ,SAAS,CAACC,IADC;EAE/BI,EAAAA,SAAS,EAAEL,SAAS,CAACC,IAFU;EAG/BK,EAAAA,WAAW,EAAEN,SAAS,CAACC,IAHQ;EAI/BM,EAAAA,SAAS,EAAEP,SAAS,CAACC,IAJU;EAK/B3B,EAAAA,MAAM,EAAE0B,SAAS,CAACE,MALa;EAM/BM,EAAAA,SAAS,EAAER,SAAS,CAACC,IANU;EAO/BQ,EAAAA,UAAU,EAAET,SAAS,CAACC;EAPS,CAAjC;;ECgeO,kBAAgBtC,IAAhB,EAAsBC,OAAtB,EAA+B;EACrC,MAAI;EACH,QAAIC,MAAM,GAAGF,IAAI,EAAjB;EACA,GAFD,CAEE,OAAMG,CAAN,EAAS;EACV,WAAOF,OAAO,CAACE,CAAD,CAAd;EACA;;EACD,MAAID,MAAM,IAAIA,MAAM,CAACE,IAArB,EAA2B;EAC1B,WAAOF,MAAM,CAACE,IAAP,CAAY,KAAK,CAAjB,EAAoBH,OAApB,CAAP;EACA;;EACD,SAAOC,MAAP;EACA;;AAxjBD,EAAe,MAAM2D,OAAN,SAAsBC,uBAAY,CAACC,SAAnC,CAA6C;EAC1DC,EAAAA,UAAU,GAAI;EACZ,UAAM;EACJC,MAAAA,WADI;EAEJtD,MAAAA,MAFI;EAGJuD,MAAAA,uBAAuB,GAAG,MAAK;EAC7B,eAAO,IAAP;EACD;EALG,QAMF,KAAKC,OANT;EAQAF,IAAAA,WAAW,CAACtD,MAAZ,GAAqBA,MAArB;EACA,UAAMuC,IAAI,GAAG,IAAIe,WAAJ,EAAb;EAEA,SAAKA,WAAL,GAAmBA,WAAnB;EACA,SAAKtD,MAAL,GAAcA,MAAd;EACA,SAAKuD,uBAAL,GAA+BA,uBAA/B;EAEA,SAAKpE,MAAL,GAAcA,MAAM,CAACoB,KAAP,CAAa;EACzBF,MAAAA,IAAI,EAAE,SADmB;EAEzBkC,MAAAA;EAFyB,KAAb,CAAd;EAKA,WAAO;EACLA,MAAAA,IADK;EAELkB,MAAAA,QAAQ,EAAE,KAFL;EAGLf,MAAAA,MAAM,EAAE,KAHH;EAIL7B,MAAAA,KAAK,EAAE;EAJF,KAAP;EAMD;;EAED,MAAI0B,IAAJ,GAAY;EACV,WAAO,KAAKmB,KAAL,CAAWnB,IAAlB;EACD;;EAED,MAAIkB,QAAJ,GAAgB;EACd,WAAO,KAAKC,KAAL,CAAWD,QAAlB;EACD;;EAED,MAAIf,MAAJ,GAAc;EACZ,WAAO,KAAKgB,KAAL,CAAWhB,MAAlB;EACD;;EAED,MAAI7B,KAAJ,GAAa;EACX,WAAO,KAAK6C,KAAL,CAAW7C,KAAlB;EACD;;EAED,MAAI8C,UAAJ,GAAkB;EAChB,WAAO,KAAKjB,MAAL,GAAc,IAAd,GAAqB,KAAK7B,KAAjC;EACD;;EAEK2B,EAAAA,IAlDoD;EAAA,QAkD5C;EAAA,oBACZ,IADY;;EACZ,YAAKrD,MAAL,CAAY8B,KAAZ,CAAkB,iBAAlB;;EACA,6BAAO,MAAK2C,OAAL;EAAA,YAAwB;EAAA,iCACvB,MAAK5D,MAAL,CAAY6D,QAAZ,EADuB;EAAA,mCAEV,MAAKP,WAAL,CAAiBd,IAAjB,EAFU,iBAEvBD,IAFuB;EAG7B,oBAAKpD,MAAL,CAAY8B,KAAZ,CAAkB,gBAAlB,EAAoC;EAACsB,gBAAAA;EAAD,eAApC;;EACA,qBAAO;EACLA,gBAAAA,IADK;EAELG,gBAAAA,MAAM,EAAE;EAFH,eAAP;EAJ6B;EAAA;EAQ9B,SARM;EAAA;EAAA;EAAA,QAAP;EASD,KA7DyD;EAAA;EAAA;EAAA;;EA+D1DD,EAAAA,MAAM,GAAI;;EAEVqB,EAAAA,KAAK,CAAEC,IAAF,EAAQ;EAAA,mBAGkB,IAHlB;;EACX,SAAK5E,MAAL,CAAY8B,KAAZ,CAAkB,kBAAlB;EACA,WAAO,KAAK2C,OAAL;EAAA,UAAwB;EAAA,+BACF,OAAKN,WAAL,CAAiBQ,KAAjB,CAAuBC,IAAvB,CADE,iBACvB;EAACxB,UAAAA,IAAD;EAAOyB,UAAAA;EAAP,SADuB;EAE7B,iBAAK7E,MAAL,CAAY8B,KAAZ,CAAkB,+BAAlB,EAAmD;EAACsB,YAAAA;EAAD,WAAnD;;EAF6B,iCAGvB,OAAKvC,MAAL,CAAYiE,OAAZ,CAAoBD,IAApB,CAHuB;EAI7B,mBAAO;EAACzB,cAAAA;EAAD,aAAP;EAJ6B;EAAA;EAK9B,OALM;EAAA;EAAA;EAAA,MAAP;EAMD;;EAED2B,EAAAA,OAAO,GAAI;EAAA,mBASU,IATV;;EACT,UAAM;EAACZ,MAAAA;EAAD,QAAgB,IAAtB;;EACA,QAAIA,WAAW,CAACY,OAAhB,EAAyB;EACvB,WAAK/E,MAAL,CAAY8B,KAAZ,CAAkB,0CAAlB;EACA,aAAO,IAAP;EACD;;EAED,SAAK9B,MAAL,CAAY8B,KAAZ,CAAkB,oBAAlB;EACA,WAAO,KAAK2C,OAAL;EAAA,UAAwB;EAC7B,cAAM;EAAC5D,UAAAA;EAAD,kBAAN;EAD6B,+BAEHA,MAAM,CAACmE,OAAP,EAFG,iBAEvBC,WAFuB;EAAA,iCAGVd,WAAW,CAACY,OAAZ,CAAoBE,WAApB,CAHU,iBAGvBrD,IAHuB;EAI7B,kBAAM;EAACwB,cAAAA,IAAD;EAAOyB,cAAAA;EAAP,gBAAejD,IAArB;;EACA,mBAAK5B,MAAL,CAAY8B,KAAZ,CAAkB,iCAAlB,EAAqD;EAACsB,cAAAA;EAAD,aAArD;;EAL6B,mCAMvBvC,MAAM,CAACiE,OAAP,CAAeD,IAAf,CANuB;EAO7B,qBAAO;EAACzB,gBAAAA;EAAD,eAAP;EAP6B;EAAA;EAAA;EAQ9B,OARM;EAAA;EAAA;EAAA,MAAP;EASD;;EAED8B,EAAAA,GAAG,CAAEN,IAAF,EAAQ;EAAA,mBAML,IANK;;EACT,UAAM;EAACT,MAAAA;EAAD,QAAgB,IAAtB;EACA,SAAKnE,MAAL,CAAY8B,KAAZ,CAAkB,gBAAlB;EACA,WAAO,KAAK2C,OAAL;EAAA,UAAwB;EAAA;EAAA,iCAOvB,OAAK5D,MAAL,CAAYsE,SAAZ,EAPuB;EAQ7B,kBAAM/B,IAAI,GAAG,IAAIe,WAAJ,EAAb;EACA,mBAAO;EAACf,cAAAA;EAAD,aAAP;EAT6B;EAAA;;EAAA,2CACzB;EAAA,iCACIe,WAAW,CAACe,GAAZ,CAAgBN,IAAhB,CADJ;EAEF,mBAAK5E,MAAL,CAAY8B,KAAZ,CAAkB,eAAlB;EAFE;EAGH,SAJ4B,YAIpBJ,KAJoB,EAIb;EACd,iBAAK1B,MAAL,CAAY0B,KAAZ,CAAkB,uBAAlB,EAA2CA,KAA3C;EACD,SAN4B;;EAAA;EAU9B,OAVM;EAAA;EAAA;EAAA,MAAP;EAWD;;EAEK+C,EAAAA,OA9GoD,CA8G3CW,MA9G2C;EAAA,QA8GnC;EAAA,qBAChB,IADgB;;EACrB,UAAI,CAAC,OAAKd,QAAV,EAAoB;EAClB,eAAKe,QAAL,CAAc;EAACf,UAAAA,QAAQ,EAAE;EAAX,SAAd;EACD;;EAHoB,0CAKjB;EAAA,+BACkBc,MAAM,EADxB,iBACIb,KADJ;EAEF,iBAAKc,QAAL;EACEf,YAAAA,QAAQ,EAAE,KADZ;EAEE5C,YAAAA,KAAK,EAAE;EAFT,aAGK6C,KAHL;EAFE;EAOH,OAZoB,YAYZ7C,KAZY,EAYL;EAAA;EAQd,iBAAK2D,QAAL,CAAc;EACZf,YAAAA,QAAQ,EAAE,KADE;EAEZlB,YAAAA,IAFY;EAGZ1B,YAAAA;EAHY,WAAd;EARc;;EACd,eAAK1B,MAAL,CAAY0B,KAAZ,CAAkB,eAAlB,EAAmC;EAACA,UAAAA;EAAD,SAAnC;;EACA,YAAI;EAAC0B,UAAAA;EAAD,kBAAJ;;EAFc;EAAA,cAGV,OAAKgB,uBAAL,CAA6B1C,KAA7B,CAHU;EAIZ,mBAAK1B,MAAL,CAAY8B,KAAZ,CAAkB,2BAAlB;;EAJY,mCAKN,OAAKjB,MAAL,CAAYsE,SAAZ,EALM;EAMZ/B,cAAAA,IAAI,GAAG,IAAP;EANY;EAAA;EAAA;;EAAA;EAaf,OAzBoB;;EAAA;EA0BtB,KAxIyD;EAAA;EAAA;EAAA;;EAAA;;EC8iBrD,kBAAgBlD,IAAhB,EAAsBC,OAAtB,EAA+B;EACrC,MAAI;EACH,QAAIC,MAAM,GAAGF,IAAI,EAAjB;EACA,GAFD,CAEE,OAAMG,CAAN,EAAS;EACV,WAAOF,OAAO,CAACE,CAAD,CAAd;EACA;;EACD,MAAID,MAAM,IAAIA,MAAM,CAACE,IAArB,EAA2B;EAC1B,WAAOF,MAAM,CAACE,IAAP,CAAY,KAAK,CAAjB,EAAoBH,OAApB,CAAP;EACA;;EACD,SAAOC,MAAP;EACA;;AA1jBD,EAAe,MAAMkF,eAAN,SAA8BvB,OAA9B,CAAsC;EACnD,MAAIc,IAAJ,GAAY;EACV,WAAO,KAAKR,OAAL,CAAaQ,IAApB;EACD;;EAED,MAAIU,QAAJ,GAAgB;EACd,WAAO,KAAKlB,OAAL,CAAakB,QAApB;EACD;;EAEKlC,EAAAA,IAT6C;EAAA,QASrC;EAAA,oBACZ,IADY;;EACZ,YAAKrD,MAAL,CAAY8B,KAAZ,CAAkB,iBAAlB;;EAEA,YAAKuD,QAAL,CAAc;EAACf,QAAAA,QAAQ,EAAE;EAAX,OAAd;;EAEA,YAAM;EAACH,QAAAA,WAAD;EAActD,QAAAA;EAAd,eAAN;;EACA,YAAMgE,IAAI,GAAG,MAAKU,QAAL,CAAcV,IAAd,EAAb;;EACA,YAAKW,WAAL,GAAmBX,IAAI,CAACY,kBAAL,WAA+BC,aAA/B;EAAA,YAAgD;EACjE,gBAAK1F,MAAL,CAAY8B,KAAZ,CAAkB,6BAAlB,EAAiD;EAAC4D,YAAAA;EAAD,WAAjD;;EADiE,iCAE3D,MAAKjB,OAAL;EAAA,gBAAwB;EAAA;EAa5B,uBAAO;EAACrB,kBAAAA,IAAD;EAAOG,kBAAAA,MAAM,EAAE;EAAf,iBAAP;EAb4B;;EAC5B,kBAAIH,IAAJ;;EAD4B;EAAA,oBAExBsC,aAFwB;EAG1B,wBAAK1F,MAAL,CAAY8B,KAAZ,CAAkB,6BAAlB;;EAH0B,yCAIN4D,aAAa,CAACC,UAAd,CAAyB,IAAzB,CAJM,iBAIpBC,KAJoB;EAK1B/E,oBAAAA,MAAM,CAACiE,OAAP,CAAe;EAACc,sBAAAA;EAAD,qBAAf;;EACA,0BAAK5F,MAAL,CAAY8B,KAAZ,CAAkB,sBAAlB;;EAN0B,2CAObqC,WAAW,CAACd,IAAZ,CAAiB;EAACxC,sBAAAA,MAAD;EAAS+E,sBAAAA,KAAT;EAAgBF,sBAAAA;EAAhB,qBAAjB,CAPa;EAO1BtC,sBAAAA,IAAI,oBAAJ;EAP0B;EAAA;EAAA;EAS1B,wBAAKpD,MAAL,CAAY8B,KAAZ,CAAkB,mCAAlB;;EAT0B,yCAUpBjB,MAAM,CAACsE,SAAP,EAVoB;EAW1B/B,oBAAAA,IAAI,GAAG,IAAIe,WAAJ,EAAP;EAX0B;EAAA;EAAA;;EAAA;EAc7B,aAdK;EAAA;EAAA;EAAA,YAF2D;EAiBlE,SAjBkB;EAAA;EAAA;EAAA,QAAnB;EAPY;EAyBb,KAlCkD;EAAA;EAAA;EAAA;;EAoC7Cb,EAAAA,MApC6C;EAAA,QAoCnC;EAAA,qBACd,IADc;;EACd,aAAKtD,MAAL,CAAY8B,KAAZ,CAAkB,2CAAlB;;EACA,aAAK0D,WAAL;;EAFc;EAGf,KAvCkD;EAAA;EAAA;EAAA;;EAyC7Cb,EAAAA,KAzC6C,CAyCtC;EACXkB,IAAAA,KADW;EAEXC,IAAAA,QAFW;EAGXC,IAAAA,QAAQ,EAAEC,aAHC;EAIXC,IAAAA,KAAK,GAAG;EAJG,GAzCsC;EAAA,QA8ChD;EAAA,qBASwB,IATxB;;EACD,YAAMC,eAAe,GAAGD,KAAK,GAAG,iBAAH,GAAuB,oBAApD;EACA,YAAME,mBAAmB,GAAG,CAAC,QAAD,EAAW,UAAX,EAAuB,SAAvB,EAAkC,QAAlC,CAA5B;;EAGA,eAASC,WAAT,GAAwB;EACtB,cAAM,IAAIzF,KAAJ,CAAW,sBAAqBqF,aAAc,EAA9C,CAAN;EACD;;EAJD,YAAMK,eAAe,GAAG,CAAC,OAAD,EAAU,WAAV,EAAuB,OAAvB,CAAxB;EAMA,YAAM;EAACd,QAAAA,QAAD;EAAWV,QAAAA;EAAX,gBAAN;EATC,kDAWG;EACF,YAAIyB,UAAJ;;EADE;EAAA,cAEEN,aAAa,CAACO,QAAd,CAAuB,OAAvB,CAFF;EAAA;EAAA,kBAGIP,aAAa,KAAK,aAHtB;EAIE,uBAAKhG,MAAL,CAAY8B,KAAZ,CAAkB,uBAAlB,EAA2C;EAAC+D,kBAAAA;EAAD,iBAA3C;;EAJF,uCAKqBhB,IAAI,CAAC2B,0BAAL,CAAgCX,KAAhC,EAAuCC,QAAvC,CALrB;EAKEQ,kBAAAA,UAAU,wBAAV;EALF;EAAA;EAAA;EAAA,sBAMWN,aAAa,KAAK,aAN7B;EAOE,2BAAKhG,MAAL,CAAY8B,KAAZ,CAAkB,uBAAlB,EAA2C;EAAC+D,sBAAAA;EAAD,qBAA3C;;EAPF,2CAQqBhB,IAAI,CAAC4B,8BAAL,CAAoCZ,KAApC,EAA2CC,QAA3C,CARrB;EAQEQ,sBAAAA,UAAU,wBAAV;;EACA,6BAAKtG,MAAL,CAAY8B,KAAZ,CAAkB,oCAAlB;;EATF,6CAUQwE,UAAU,CAAClD,IAAX,CAAgBsD,qBAAhB,EAVR;EAAA;EAAA;EAYEN,oBAAAA,WAAW;EAZb;EAAA;;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA,kBAcSD,mBAAmB,CAACI,QAApB,CAA6BP,aAA7B,CAdT;EAeA,sBAAMW,QAAQ,GAAGpB,QAAQ,CAACV,IAAT,CAAe,GAAEmB,aAAc,cAA/B,CAAjB;EACA,sBAAMD,QAAQ,GAAG,IAAIY,QAAJ,EAAjB;;EACA,uBAAK3G,MAAL,CAAY8B,KAAZ,CAAkB,oCAAlB,EAAwD;EAACkE,kBAAAA,aAAD;EAAgBE,kBAAAA;EAAhB,iBAAxD;;EAjBA,uCAkBmBrB,IAAI,CAACqB,eAAD,CAAJ,CAAsBH,QAAtB,CAlBnB;EAkBAO,kBAAAA,UAAU,wBAAV;EAlBA;EAAA;EAAA;EAAA,sBAmBSD,eAAe,CAACE,QAAhB,CAAyBP,aAAzB,CAnBT;EAoBA,0BAAMY,MAAM,GAAI,GAAEZ,aAAa,CAACa,WAAd,EAA4B,MAA9C;EACA,0BAAMd,QAAQ,GAAG,IAAIR,QAAQ,CAACV,IAAT,CAAciC,aAAlB,CAAgCF,MAAhC,CAAjB;;EACA,2BAAK5G,MAAL,CAAY8B,KAAZ,CAAkB,gCAAlB,EAAoD;EAAC8E,sBAAAA,MAAD;EAASV,sBAAAA;EAAT,qBAApD;;EAtBA,2CAuBmBrB,IAAI,CAACqB,eAAD,CAAJ,CAAsBH,QAAtB,CAvBnB;EAuBAO,sBAAAA,UAAU,yBAAV;EAvBA;EAAA;EAyBAF,oBAAAA,WAAW;EAzBX;EAAA;;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;;EAAA;EA2BF,iBAAOE,UAAP;EA3BE,aA2BKA,UA3BL;EA4BH,OAvCA,YAuCQ5E,KAvCR,EAuCe;EACd,eAAK1B,MAAL,CAAY8B,KAAZ,CAAkB,sBAAlB,EAA0CJ,KAA1C;;EACA,cAAMA,KAAN;EACD,OA1CA;EA2CF,KAzFkD;EAAA;EAAA;EAAA;;EA2F7CwD,EAAAA,GA3F6C;EAAA,QA2FtC;EAAA,qBACX,IADW;;EACX,aAAKG,QAAL,CAAc;EAACf,QAAAA,QAAQ,EAAE;EAAX,OAAd;;EACA,6BAAO,OAAKO,IAAL,CAAUkC,OAAV,EAAP;EACD,KA9FkD;EAAA;EAAA;EAAA;;EAAA;;ECgjB9C,SAASC,QAAT,CAAgB9G,IAAhB,EAAsBC,OAAtB,EAA+B;EACrC,MAAI;EACH,QAAIC,MAAM,GAAGF,IAAI,EAAjB;EACA,GAFD,CAEE,OAAMG,CAAN,EAAS;EACV,WAAOF,OAAO,CAACE,CAAD,CAAd;EACA;;EACD,MAAID,MAAM,IAAIA,MAAM,CAACE,IAArB,EAA2B;EAC1B,WAAOF,MAAM,CAACE,IAAP,CAAY,KAAK,CAAjB,EAAoBH,OAApB,CAAP;EACA;;EACD,SAAOC,MAAP;EACA;;EApjBD,MAAM6G,UAAU,GAAG;EACjBrB,EAAAA,KAAK,EAAE,IADU;EAEjBsB,EAAAA,aAAa,EAAE;EAFE,CAAnB;AAKA,EAAe,SAASC,SAAT,CAAoB;EAACC,EAAAA,GAAD;EAAMC,EAAAA,OAAN;EAAeC,EAAAA,WAAW,GAAG;EAA7B,CAApB,EAA+D;EAAA,QA0E7DnC,SA1E6D;EAAA,QA0EhD;EAAA;EAK1B,eAAOoC,eAAe,CAACN,UAAD,CAAtB;EAL0B;;EAC1BjH,MAAAA,QAAM,CAAC8B,KAAP,CAAa,uBAAb;;EAD0B;EAAA,YAEtBuF,OAFsB;EAAA,iCAGlBG,kBAAkB,CAACP,UAAD,CAHA;EAAA;EAAA;;EAAA;EAM3B,KAhF2E;EAAA;EAAA;EAAA;;EAAA,QAiE7DvC,QAjE6D;EAAA,QAiEjD;EACzB,UAAI,CAAC2C,OAAL,EAAc;EACZ,cAAM,IAAI1G,KAAJ,CAAU,wCAAV,CAAN;EACD;;EACDX,MAAAA,QAAM,CAAC8B,KAAP,CAAa,sBAAb;EAJyB,6BAKN2F,mBAAmB,EALb,OAMlBF,eANkB;EAO1B,KAxE2E;EAAA;EAAA;EAAA;;EAAA,QAyD7DzC,OAzD6D,aAyDpDD,IAzDoD;EAAA,QAyD9C;EAAA;EAK5B,eAAO0C,eAAe,CAAC1C,IAAD,CAAtB;EAL4B;;EAC5B7E,MAAAA,QAAM,CAAC8B,KAAP,CAAa,sBAAb;;EAD4B;EAAA,YAExBuF,OAFwB;EAAA,iCAGpBG,kBAAkB,CAAC3C,IAAD,CAHE;EAAA;EAAA;;EAAA;EAM7B,KA/D2E;EAAA;EAAA;EAAA;;EAAA,QA6C7D4C,mBA7C6D;EAAA,QA6CtC;EACpCzH,MAAAA,QAAM,CAAC8B,KAAP,CAAa,2BAAb;EACA,UAAI+C,IAAJ;;EAFoC,yCAGhC;EAAA,+BACiBwC,OAAO,CAACK,OAAR,CAAgBJ,WAAhB,CADjB,iBACIK,IADJ;EAEF9C,UAAAA,IAAI,GAAG+C,IAAI,CAACC,KAAL,CAAWF,IAAX,KAAoB,EAA3B;EAFE;EAGH,OANmC,cAMpB;EACd9C,QAAAA,IAAI,GAAG,EAAP;EACD,OARmC;;EAAA;EASpC,eAAOA,IAAP;EAToC,WAS7BA,IAT6B;EAUrC,KAvD2E;EAAA;EAAA;EAAA;;EAAA,QAsB7DiD,cAtB6D;EAAA,QAsB3C;EAC/B9H,MAAAA,QAAM,CAAC8B,KAAP,CAAa,qBAAb;EACA,YAAMK,KAAK,GAAG4F,GAAI;;;;;KAAlB;EAF+B,6BAQVlH,MAAM,CAACsB,KAAP,CAAa;EAACA,QAAAA;EAAD,OAAb,CARU,iBAQzB;EAACP,QAAAA;EAAD,OARyB;EAS/B,eAAOA,IAAP;EAT+B;EAUhC,KAhC2E;EAAA;EAAA;EAAA;;EAC5E,QAAM5B,QAAM,GAAGmB,MAAW,CAACC,KAAZ,CAAkB;EAACF,IAAAA,IAAI,EAAE,WAAP;EAAoBkG,IAAAA;EAApB,GAAlB,CAAf;EAEApH,EAAAA,QAAM,CAAC0D,IAAP,CAAY,gBAAZ;EAEA,QAAMsE,SAAS,GAAGC,6BAAc,CAAC;EAACb,IAAAA;EAAD,GAAD,CAAhC;EAEA,QAAMc,SAAS,GAAGC,4BAAU,WAAQC,OAAR,EAAiBC,YAAjB;EAAA,QAAiC;EAC3D,YAAM;EAACC,QAAAA,OAAO,GAAG;EAAX,UAAiBD,YAAvB;EAD2D,6BAErCP,cAAc,EAFuB,iBAErD;EAAClC,QAAAA;EAAD,OAFqD;EAG3D,YAAIA,KAAJ,EAAW;EACT5F,UAAAA,QAAM,CAAC8B,KAAP,CAAa,6BAAb;EACAwG,UAAAA,OAAO,CAACC,aAAR,GAAwB3C,KAAK,GAAI,UAASA,KAAM,EAAnB,GAAuB,EAApD;EACD;;EACD,eAAO;EAAC0C,UAAAA;EAAD,SAAP;EAP2D;EAQ5D,KAR2B;EAAA;EAAA;EAAA,IAA5B;EAUA,QAAME,IAAI,GAAGN,SAAS,CAACO,MAAV,CAAiBT,SAAjB,CAAb;EACA,QAAMU,KAAK,GAAG,IAAIC,iCAAJ,EAAd;EACA,QAAM9H,MAAM,GAAG,IAAI+H,yBAAJ,CAAiB;EAACJ,IAAAA,IAAD;EAAOE,IAAAA;EAAP,GAAjB,CAAf;EACAnB,EAAAA,eAAe,CAACN,UAAD,CAAf;;EAcA,WAASM,eAAT,CAA0B1C,IAA1B,EAAgC;EAC9B7E,IAAAA,QAAM,CAAC8B,KAAP,CAAa,qBAAb;EACA,WAAOjB,MAAM,CAACgI,SAAP,CAAiB;EAACjH,MAAAA,IAAI,EAAEiD;EAAP,KAAjB,CAAP;EACD;;EAED,WAAS2C,kBAAT,CAA6B3C,IAA7B,EAAmC;EACjC7E,IAAAA,QAAM,CAAC8B,KAAP,CAAa,yBAAb;EACA,UAAM6F,IAAI,GAAGC,IAAI,CAACkB,SAAL,CAAejE,IAAf,CAAb;EACA,WAAOwC,OAAO,CAAC0B,OAAR,CAAgBzB,WAAhB,EAA6BK,IAA7B,CAAP;EACD;;EAuCD9G,EAAAA,MAAM,CAACiE,OAAP,GAAiBA,OAAjB;EACAjE,EAAAA,MAAM,CAAC6D,QAAP,GAAkBA,QAAlB;EACA7D,EAAAA,MAAM,CAACsE,SAAP,GAAmBA,SAAnB;EAEA,SAAOtE,MAAP;EACD;;EClGc,SAASmI,mBAAT,CAA8BtH,KAA9B,EAAqC;EAClD,MAAIuH,IAAI,GAAGC,GAAG,CAACxH,KAAD,EAAQ,kCAAR,EAA4C,IAA5C,CAAd;;EACA,MAAI,CAACuH,IAAL,EAAW;EACTA,IAAAA,IAAI,GAAGC,GAAG,CAACxH,KAAD,EAAQ,+CAAR,EAAyD,IAAzD,CAAV;EACD;;EACD,SAAOuH,IAAP;EACD;;ECRc,SAASE,YAAT,CAAuBC,QAAvB,EAAiC;EAC9C,QAAMC,KAAK,GAAGD,QAAQ,CAACE,KAAT,CAAe,GAAf,CAAd;EAEA,MAAIC,UAAU,GAAG,CAAC,CAAlB;EACA,QAAMC,IAAI,GAAGH,KAAK,CAACA,KAAK,CAACI,MAAN,GAAe,CAAhB,CAAlB;EACA,QAAMC,YAAY,GAAGF,IAAI,KAAK,WAA9B;;EACA,MAAIE,YAAJ,EAAkB;EAChBH,IAAAA,UAAU,GAAG,CAAC,CAAd;EACD;;EAED,SAAOF,KAAK,CAACM,KAAN,CAAY,CAAZ,EAAeJ,UAAf,EAA2BK,IAA3B,CAAgC,GAAhC,CAAP;EACD;;ECTc,SAASC,aAAT,CAAwBC,GAAxB,EAA6B;EAC1C,QAAMC,IAAI,GAAGD,GAAG,CAACE,IAAJ,CAAUC,IAAD,IAASA,IAAI,CAACF,IAAvB,CAAb;;EACA,MAAI,CAACA,IAAL,EAAW;EACT,UAAM,IAAIpJ,KAAJ,CAAU,0DAAV,CAAN;EACD;;EAED,SAAO,SAASuJ,MAAT,GAAmB;EACxB,UAAM;EAACd,MAAAA;EAAD,QAAae,MAAM,CAACC,QAA1B;EACA,UAAMC,SAAS,GAAGlB,YAAY,CAACC,QAAD,CAA9B;;EAEA,QAAI,CAACiB,SAAL,EAAgB;EACd,aAAON,IAAI,CAACO,GAAZ;EACD;;EAED,UAAMA,GAAG,GAAGR,GAAG,CAACE,IAAJ,CAAS,CAAC;EAACO,MAAAA;EAAD,KAAD,KAAiBA,UAAU,CAAChE,QAAX,CAAoB8D,SAApB,CAA1B,CAAZ;;EACA,QAAIC,GAAJ,EAAS;EACP,aAAOA,GAAG,CAACA,GAAX;EACD,KAFD,MAEO;EACL,aAAOP,IAAI,CAACO,GAAZ;EACD;EACF,GAdD;EAeD;;EClBc,MAAME,MAAN,SAAqBxG,uBAAY,CAACC,SAAlC,CAA4C;EACzDC,EAAAA,UAAU,GAAI;EACZ,SAAKuG,OAAL,GAAe,EAAf;;EAEA,QAAK,SAAS,KAAKpG,OAAnB,EAA6B;EAC3B,WAAKqG,GAAL,GAAW,KAAKrG,OAAL,CAAaqG,GAAxB;EACD,KAFD,MAEO;EACL,WAAKA,GAAL,GAAW,CAAC,EAAEP,MAAM,IAAIA,MAAM,CAACC,QAAjB,IAA6BD,MAAM,CAACM,OAAtC,CAAZ;EACD;;EAED,UAAM;EAACE,MAAAA,MAAD;EAASC,MAAAA;EAAT,QAAsB,KAAKvG,OAAjC;EACA,SAAKpB,MAAL,GAAc,IAAI4H,QAAQ,CAACL,MAAb,CAAoB;EAACG,MAAAA,MAAD;EAASC,MAAAA;EAAT,KAApB,CAAd;EACA,SAAK3H,MAAL,CAAY6H,IAAZ,CAAiB,KAAKC,KAAL,CAAWvK,IAAX,CAAgB,IAAhB,CAAjB;EAEA,QAAImD,GAAG,GAAG,GAAV;;EACA,QAAI,KAAK+G,GAAT,EAAc;EACZ,YAAM;EAACN,QAAAA;EAAD,UAAaD,MAAnB;EACA,YAAM;EAACa,QAAAA,QAAD;EAAWC,QAAAA;EAAX,UAAqBb,QAA3B;EACAzG,MAAAA,GAAG,GAAI,GAAEqH,QAAS,GAAEC,MAAO,EAA3B;EACAd,MAAAA,MAAM,CAACe,gBAAP,CAAwB,UAAxB,EAAoC,KAAKC,WAAL,CAAiB3K,IAAjB,CAAsB,IAAtB,CAApC;EACD;;EAED,SAAKR,MAAL,GAAcA,MAAM,CAACoB,KAAP,CAAa;EACzBF,MAAAA,IAAI,EAAE,QADmB;EAEzBwJ,MAAAA,GAAG,EAAE,KAAKA;EAFe,KAAb,CAAd;EAKA,SAAK1K,MAAL,CAAY8B,KAAZ,CAAkB,qBAAlB;EAEA,WAAO;EAAC6B,MAAAA;EAAD,KAAP;EACD;;EAED,MAAIA,GAAJ,GAAW;EACT,WAAO,KAAKY,KAAL,CAAWZ,GAAlB;EACD;;EAED,MAAIjC,KAAJ,GAAa;EACX,WAAO,KAAK6C,KAAL,CAAW7C,KAAlB;EACD;;EAEDd,EAAAA,KAAK,CAAEwK,KAAF,EAAS;EACZ,SAAKA,KAAL,GAAaA,KAAb;EACA,UAAMxK,KAAK,GAAG,KAAKqC,MAAL,CAAYrC,KAAZ,cACTwK,KADS;EAEZzH,MAAAA,GAAG,EAAE,KAAKA;EAFE,OAAd;EAIA,SAAK3D,MAAL,CAAY8B,KAAZ,CAAkB,cAAlB,EAAkC;EAAClB,MAAAA,KAAD;EAAQwK,MAAAA;EAAR,KAAlC;;EACA,QAAIxK,KAAJ,EAAW;EACT,UAAIA,KAAK,CAAC4C,QAAV,EAAoB;EAClB,aAAK6H,OAAL,CAAazK,KAAK,CAAC+C,GAAnB;EACD;EACF,KAJD,MAIO;EACL,YAAMjC,KAAK,GAAG,IAAIf,KAAJ,CAAU,4BAAV,CAAd;EACA,WAAK0E,QAAL,CAAc;EAAC3D,QAAAA;EAAD,OAAd;EACD;;EACD,WAAOd,KAAP;EACD;;EAED0K,EAAAA,EAAE,CAAE1G,IAAF,EAAQ;EACRA,IAAAA,IAAI,gBACC,KAAKwG,KADN,EAEC,KAAKnI,MAAL,CAAYsI,eAAZ,CAA4B3G,IAA5B,CAFD,CAAJ;EAIA,SAAK5E,MAAL,CAAY8B,KAAZ,CAAkB,kBAAlB,EAAsC;EAAC8C,MAAAA,IAAD;EAAOjB,MAAAA,GAAG,EAAE,KAAKA;EAAjB,KAAtC;EACA,SAAKV,MAAL,CAAYqI,EAAZ,CAAe1G,IAAf;EACD;;EAED4G,EAAAA,IAAI,GAAI;EACN,UAAMhC,IAAI,GAAG,KAAKiB,OAAL,CAAagB,GAAb,EAAb;;EACA,QAAI,CAACjC,IAAL,EAAW;EACT;EACD;;EACD,SAAK8B,EAAL,CAAQ9B,IAAR;EACD;;EAED6B,EAAAA,OAAO,CAAE1H,GAAF,EAAO;EACZ,SAAK3D,MAAL,CAAY8B,KAAZ,CAAkB,oBAAlB,EAAwC6B,GAAxC;;EACA,QAAIA,GAAG,KAAK,KAAKA,GAAjB,EAAsB;EACpB,YAAMY,KAAK,GAAG;EAACZ,QAAAA;EAAD,OAAd;EACA,WAAK0B,QAAL,CAAcd,KAAd;EACA,WAAKkG,OAAL,CAAaiB,IAAb,CAAkBnH,KAAlB;;EACA,UAAI,KAAKmG,GAAT,EAAc;EACZP,QAAAA,MAAM,CAACM,OAAP,CAAekB,SAAf,CAAyBpH,KAAzB,EAAgC,EAAhC,EAAoCZ,GAApC;EACD;EACF;EACF;;EAEDoH,EAAAA,KAAK,CAAEnK,KAAF,EAAS;EACZ,SAAKZ,MAAL,CAAY8B,KAAZ,CAAkB,oBAAlB,EAAwC;EAAClB,MAAAA,KAAD;EAAQgL,MAAAA,OAAO,EAAE,KAAKjI;EAAtB,KAAxC;EACA,UAAM;EAACA,MAAAA;EAAD,QAAQ/C,KAAd;;EACA,QAAI+C,GAAG,KAAK,KAAKA,GAAjB,EAAsB;EACpB,WAAK0H,OAAL,CAAa1H,GAAb;;EACA,YAAM;EAACmH,QAAAA;EAAD,UAAS,KAAKzG,OAApB;;EACA,UAAIyG,IAAJ,EAAU;EACRA,QAAAA,IAAI,CAAClK,KAAD,CAAJ;EACD;EACF;EACF;;EAEDuK,EAAAA,WAAW,CAAE;EAAC5G,IAAAA;EAAD,GAAF,EAAW;EACpB,SAAKc,QAAL,CAAcd,KAAd;EACD;;EArGwD;;;;;;;;;;;;;;;;;;;;;;;;"}