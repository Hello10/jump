{"version":3,"file":"index.umd.js","sources":["../src/logger.js","../src/PageContainer.js","../src/ApplicationContainer.js","../src/Session.js","../src/FirebaseSession.js","../src/getClient.js","../src/getGraphQLErrorCode.js","../src/getSubdomain.js","../src/subdomainApps.js","../src/Router.js"],"sourcesContent":["import Logger from '@hello10/logger';\n\nconst logger = new Logger('jump');\n\nexport default logger;\n","import * as React from 'react';\nimport {useQuery} from '@apollo/client';\n\nimport base_logger from './logger';\n\nconst logger = base_logger.child('PageContainer');\n\nfunction Query ({Loading, Error, Page, ...props}) {\n  const {name, params, user} = props;\n  const {query: query_gql, ...options} = Page.query({params, user});\n  const query = useQuery(query_gql, options);\n  const {loading, error, data} = query;\n\n  logger.debug('Rendering page container query', {...props, loading, error, data});\n\n  if (loading) {\n    logger.debug(`Rendering loading for ${name}`);\n    return (\n      <Loading\n        Page={Page}\n        query={query}\n        {...props}\n      />\n    );\n  } else if (error) {\n    logger.debug(`Rendering error for ${name}`);\n    return (\n      <Error\n        Page={Page}\n        error={error}\n        query={query}\n        {...props}\n      />\n    );\n  } else {\n    logger.debug(`Rendering loaded for ${name}`);\n    return (\n      <Page\n        data={data}\n        query={query}\n        {...props}\n      />\n    );\n  }\n}\n\nexport function PageContainer (props) {\n  const {route, params} = props.match;\n  const {page: Page, name} = route;\n\n  const page_props = {route, params, name};\n\n  if (Page.query) {\n    return (\n      <Query\n        Page={Page}\n        {...props}\n        {...page_props}\n      />\n    );\n  } else {\n    return (\n      <Page\n        data={{}}\n        query={null}\n        {...props}\n        {...page_props}\n      />\n    );\n  }\n}\n","import React, {useEffect} from 'react';\nimport PropTypes from 'prop-types';\n\nimport base_logger from './logger';\nimport {PageContainer} from './PageContainer';\n\nexport default function ApplicationContainer ({\n  ApplicationLoading,\n  Container,\n  PageLoading,\n  PageError,\n  client,\n  useRouter,\n  useSession,\n  ...props\n}) {\n  const logger = base_logger.child('ApplicationContainer');\n  logger.debug('Rendering ApplicationContainer');\n\n  const router = useRouter();\n  const session = useSession();\n  const {user} = session;\n\n  useEffect(()=> {\n    logger.debug('Loading session');\n    session.load();\n    return ()=> {\n      logger.debug('Unloading session');\n      session.unload();\n    };\n  }, []);\n\n  useEffect(()=> {\n    logger.debug('Running router', {user});\n    if (!session.loaded) {\n      return;\n    }\n    const match = router.start({user});\n    if (match?.redirect) {\n      const {route} = match;\n      let msg = 'Got redirect';\n      const name = route?.name;\n      if (name) {\n        msg = `${msg} to ${name}`;\n      }\n      logger.info(msg, {match});\n    }\n  }, [user]);\n\n  if (session.loaded && router.match) {\n    return (\n      <Container\n        match={router.match}\n      >\n        <PageContainer\n          Loading={PageLoading}\n          Error={PageError}\n          match={router.match}\n          client={client}\n          user={user}\n          {...props}\n        />\n      </Container>\n    );\n  } else {\n    return (\n      <ApplicationLoading\n        error={session.error || router.error}\n        user={user}\n        {...props}\n      />\n    );\n  }\n}\n\nApplicationContainer.whyDidYouRender = {\n  logOnDifferentValues: true\n};\n\nApplicationContainer.propTypes = {\n  ApplicationLoading: PropTypes.func,\n  Container: PropTypes.func,\n  PageLoading: PropTypes.func,\n  PageError: PropTypes.func,\n  client: PropTypes.object,\n  useRouter: PropTypes.func,\n  useSession: PropTypes.func\n};\n","import {mapp} from '@hello10/util';\nimport {useSingleton} from '@hello10/react-hooks';\n\nimport logger from './logger';\n\nexport default class Session extends useSingleton.Singleton {\n  initialize () {\n    const {\n      Firebase,\n      SessionUser,\n      client,\n      shouldEndSessionOnError = ()=> {\n        return true;\n      }\n    } = this.options;\n\n    SessionUser.client = client;\n    const user = new SessionUser();\n\n    this.Firebase = Firebase;\n    this.SessionUser = SessionUser;\n    this.client = client;\n    this.shouldEndSessionOnError = shouldEndSessionOnError;\n\n    this.logger = logger.child({\n      name: 'Session',\n      user\n    });\n\n    return {\n      user,\n      changing: false,\n      loaded: false,\n      error: null\n    };\n  }\n\n  get user () {\n    return this.state.user;\n  }\n\n  set user (data) {\n    const user = new this.SessionUser(data);\n    this.setState({user});\n  }\n\n  get changing () {\n    return this.state.changing;\n  }\n\n  get loaded () {\n    return this.state.loaded;\n  }\n\n  get error () {\n    return this.state.error;\n  }\n\n  get load_error () {\n    return this.loaded ? null : this.error;\n  }\n\n  apps (fn) {\n    return mapp(this.Firebase.apps, fn);\n  }\n\n  async load () {\n    this.logger.debug('Loading session');\n    return this._change(async ()=> {\n      await this.client.loadAuth();\n      const user = await this.SessionUser.load();\n      this.logger.debug('Session loaded', {user});\n      return {\n        user,\n        loaded: true\n      };\n    });\n  }\n\n  unload () {}\n\n  start (args) {\n    this.logger.debug('Starting session');\n    return this._change(async ()=> {\n      const {user, auth} = await this.SessionUser.start(args);\n      this.logger.debug('Session started, setting auth', {user});\n      await this.client.setAuth(auth);\n      await this.apps((app)=> {\n        const app_token = auth.app_tokens.find(({name})=> name === app.name);\n        if (!app_token) {\n          return null;\n        }\n        return app.auth().signInWithCustomToken(app_token.token);\n      });\n      return {user};\n    });\n  }\n\n  refresh () {\n    const {SessionUser} = this;\n    if (!SessionUser.refresh) {\n      this.logger.debug('No refresh method defined on SessionUser');\n      return null;\n    }\n\n    this.logger.debug('Refreshing session');\n    return this._change(async ()=> {\n      const {client} = this;\n      const client_auth = await client.loadAuth();\n      const data = await SessionUser.refresh(client_auth);\n      const {user, auth} = data;\n      this.logger.debug('Session refreshed, setting auth', {user});\n      await client.setAuth(auth);\n      return {user};\n    });\n  }\n\n  end (args) {\n    const {SessionUser} = this;\n    this.logger.debug('Ending session');\n    return this._change(async ()=> {\n      try {\n        await SessionUser.end(args);\n        this.logger.debug('Session ended');\n      } catch (error) {\n        this.logger.error('Error ending session', error);\n      }\n      await this.client.clearAuth();\n      await this.apps((app)=> {\n        app.auth().signOut();\n      });\n      const user = new SessionUser();\n      return {user};\n    });\n  }\n\n  async _change (action) {\n    if (!this.changing) {\n      this.setState({changing: true});\n    }\n\n    try {\n      const state = await action();\n      this.setState({\n        changing: false,\n        error: null,\n        ...state\n      });\n    } catch (error) {\n      this.logger.error('Session error', {error});\n      let {user} = this;\n      if (this.shouldEndSessionOnError(error)) {\n        this.logger.debug('Clearing session on error');\n        await this.client.clearAuth();\n        user = null;\n      }\n      this.setState({\n        changing: false,\n        user,\n        error\n      });\n    }\n  }\n}\n","import Session from './Session';\n\nexport default class FirebaseSession extends Session {\n  get auth () {\n    return this.Firebase.auth();\n  }\n\n  async load () {\n    this.logger.debug('Loading session');\n\n    this.setState({changing: true});\n\n    const {SessionUser, client} = this;\n    this.unsubscribe = this.auth.onAuthStateChanged(async (firebase_user)=> {\n      this.logger.debug('Firebase auth state changed', {firebase_user});\n      await this._change(async ()=> {\n        let user;\n        if (firebase_user) {\n          this.logger.debug('Getting firebase user token');\n          const token = await firebase_user.getIdToken(true);\n          client.setAuth({token});\n          this.logger.debug('Loading session user');\n          user = await SessionUser.load({client, token, firebase_user});\n        } else {\n          this.logger.debug('No firebase user clearing session');\n          await client.clearAuth();\n          user = new SessionUser();\n        }\n        return {user, loaded: true};\n      });\n    });\n  }\n\n  async unload () {\n    this.logger.debug('Unsubscribing from Firebase auth listener');\n    this.unsubscribe();\n  }\n\n  async start ({\n    email,\n    password,\n    provider: provider_name,\n    popup = false\n  }) {\n    const provider_method = popup ? 'signInWithPopup' : 'signInWithRedirect';\n    const dedicated_providers = ['Google', 'Facebook', 'Twitter', 'Github'];\n    const oauth_providers = ['Yahoo', 'Microsoft', 'Apple'];\n\n    function invalidMode () {\n      throw new Error(`Invalid auth mode: ${provider_name}`);\n    }\n\n    const {Firebase, auth} = this;\n\n    try {\n      let credential;\n      if (provider_name.includes('Email')) {\n        if (provider_name === 'EmailSignin') {\n          this.logger.debug('Signing in with email', {email});\n          credential = await auth.signInWithEmailAndPassword(email, password);\n        } else if (provider_name === 'EmailSignup') {\n          this.logger.debug('Signing up with email', {email});\n          credential = await auth.createUserWithEmailAndPassword(email, password);\n          this.logger.debug('Sending session email verification');\n          await credential.user.sendEmailVerification();\n        } else {\n          invalidMode();\n        }\n      } else if (dedicated_providers.includes(provider_name)) {\n        const Provider = Firebase.auth[`${provider_name}AuthProvider`];\n        const provider = new Provider();\n        this.logger.debug('Authorizing via dedicated provider', {provider_name, provider_method});\n        credential = await auth[provider_method](provider);\n      } else if (oauth_providers.includes(provider_name)) {\n        const domain = `${provider_name.toLowerCase()}.com`;\n        const provider = new Firebase.auth.OAuthProvider(domain);\n        this.logger.debug('Authorizing via OAuth provider', {domain, provider_method});\n        credential = await auth[provider_method](provider);\n      } else {\n        invalidMode();\n      }\n      return credential;\n    } catch (error) {\n      this.logger.debug('Error authenticating', error);\n      throw error;\n    }\n  }\n\n  async end () {\n    this.setState({changing: true});\n    return this.auth.signOut();\n  }\n}\n","import {\n  ApolloClient,\n  from,\n  HttpLink,\n  InMemoryCache\n} from '@apollo/client';\nimport {setContext} from '@apollo/client/link/context';\n\nimport base_logger from './logger';\n\nconst NO_SESSION = {\n  token: null,\n  refresh_token: null\n};\n\nlet auth = null;\n\nexport default function getClient ({\n  uri,\n  storage,\n  storage_key = 'JUMP_AUTH',\n  options = {},\n  cache_options = {}\n}) {\n  const logger = base_logger.child({name: 'getClient', uri});\n\n  logger.info('Getting client');\n\n  const http_link = new HttpLink({uri});\n\n  const auth_link = setContext(async (request, prev_context)=> {\n    const {headers = {}} = prev_context;\n    if (!auth) {\n      await loadAuth();\n    }\n    const {token} = auth;\n    if (token) {\n      logger.debug('Adding auth token to header');\n      headers.authorization = token ? `Bearer ${token}` : '';\n    }\n    return {headers};\n  });\n\n  const link = from([auth_link, http_link]);\n  const cache = new InMemoryCache(cache_options);\n  const client = new ApolloClient({link, cache, defaultOptions: options});\n\n  function writeAuthToStorage (auth) {\n    logger.debug('Writing auth to storage');\n    const json = JSON.stringify(auth);\n    return storage.setItem(storage_key, json);\n  }\n\n  async function readAuthFromStorage () {\n    logger.debug('Reading auth from storage');\n    let auth;\n    try {\n      const json = await storage.getItem(storage_key);\n      auth = JSON.parse(json) || NO_SESSION;\n    } catch (error) {\n      auth = NO_SESSION;\n    }\n    return auth;\n  }\n\n  async function setAuth (new_auth) {\n    logger.debug('Setting session auth');\n    if (storage) {\n      await writeAuthToStorage(new_auth);\n    }\n    auth = new_auth;\n  }\n\n  async function loadAuth () {\n    if (!storage) {\n      throw new Error('No storage specified to load auth from');\n    }\n    logger.debug('Loading session auth');\n    auth = await readAuthFromStorage();\n    return auth;\n  }\n\n  async function clearAuth () {\n    logger.debug('Clearing session auth');\n    setAuth(NO_SESSION);\n  }\n\n  client.setAuth = setAuth;\n  client.loadAuth = loadAuth;\n  client.clearAuth = clearAuth;\n\n  return client;\n}\n","export default function getGraphQLErrorCode (error) {\n  if (error.graphQLErrors) {\n    ([error] = error.graphQLErrors);\n  }\n  return error?.extensions?.code;\n}\n","export default function getSubdomain (hostname) {\n  const parts = hostname.split('.');\n\n  let last_index = -2;\n  const last = parts[parts.length - 1];\n  const is_localhost = last === 'localhost';\n  if (is_localhost) {\n    last_index = -1;\n  }\n\n  return parts.slice(0, last_index).join('.');\n}\n","import getSubdomain from './getSubdomain';\n\nexport default function subdomainApps (map) {\n  const main = map.find((item)=> item.main);\n  if (!main) {\n    throw new Error('Must set main flag to true on at least one subdomain app');\n  }\n\n  return function getApp () {\n    const {hostname} = window.location;\n    const subdomain = getSubdomain(hostname);\n\n    if (!subdomain) {\n      return main.app;\n    }\n\n    const app = map.find(({subdomains})=> subdomains.includes(subdomain));\n    if (app) {\n      return app.app;\n    } else {\n      return main.app;\n    }\n  };\n}\n","import {useSingleton} from '@hello10/react-hooks';\nimport Groutcho from 'groutcho';\n\nimport logger from './logger';\n\nexport default class Router extends useSingleton.Singleton {\n  initialize () {\n    this.history = [];\n\n    if (('web' in this.options)) {\n      this.web = this.options.web;\n    } else {\n      this.web = !!(window && window.location && window.history);\n    }\n\n    if (this.web) {\n      window.addEventListener('popstate', this._onPopState.bind(this));\n    }\n\n    const {routes, redirects} = this.options;\n    this.router = new Groutcho.Router({routes, redirects});\n    this.router.onGo(this._onGo.bind(this));\n\n    this.logger = logger.child({\n      name: 'Router',\n      web: this.web\n    });\n\n    this.logger.debug('Initializing router');\n\n    return {\n      match: null,\n      error: null,\n      input: null\n    };\n  }\n\n  get url () {\n    return this.match?.url;\n  }\n\n  get error () {\n    return this.state.error;\n  }\n\n  get match () {\n    return this.state.match;\n  }\n\n  get route () {\n    return this.match?.route;\n  }\n\n  get params () {\n    return this.match?.params;\n  }\n\n  get page () {\n    return this.route?.page;\n  }\n\n  get input () {\n    return this.state.input;\n  }\n\n  start ({url, ...input}) {\n    if (!url) {\n      url = '/';\n      if (this.web) {\n        const {location} = window;\n        const {pathname, search} = location;\n        url = `${pathname}${search}`;\n      }\n    }\n    const match = this.router.match({...input, url});\n    this._handleMatch({match, input});\n    return match;\n  }\n\n  go (args) {\n    args = {\n      ...this.input,\n      ...this.router._normalizeInput(args)\n    };\n    this.logger.debug('Router go called', {args, current: this.url});\n    this.router.go(args);\n  }\n\n  back () {\n    const state = this.history.pop();\n    if (!state) {\n      return;\n    }\n    if (this.web) {\n      window.history.back();\n    } else {\n      this._onPopState({state});\n    }\n  }\n\n  _handleMatch ({match, input}) {\n    this.logger.debug('Router handling match', {match, input});\n    if (match) {\n      if (match.url !== this.url) {\n        const state = {url: match.url};\n        this.history.push(state);\n        if (this.web) {\n          window.history.pushState(state, '', match.url);\n        }\n        this.setState({match, input, error: null});\n      }\n    } else {\n      const error = new Error('No match from router');\n      this.setState({match, input, error});\n    }\n  }\n\n  _onGo (match) {\n    this.logger.debug('Router onGo called', {match});\n    const {input} = this;\n    this._handleMatch({match, input});\n    const {onGo} = this.options;\n    if (onGo) {\n      onGo(this.state);\n    }\n  }\n\n  _onPopState ({state}) {\n    const {url} = state;\n    const {input} = this;\n    const match = this.router.match({...input, url});\n    if (match) {\n      this.setState({match, input, error: null});\n    } else {\n      const error = new Error('No match from router');\n      this.setState({match, input, error});\n    }\n  }\n}\n"],"names":["logger","Logger","base_logger","child","Query","Loading","Error","Page","props","name","params","user","query","query_gql","options","useQuery","loading","error","data","debug","React.createElement","PageContainer","route","match","page","page_props","ApplicationContainer","ApplicationLoading","Container","PageLoading","PageError","client","useRouter","useSession","router","session","useEffect","load","unload","loaded","start","redirect","msg","info","React","whyDidYouRender","logOnDifferentValues","propTypes","PropTypes","func","object","body","recover","result","e","then","Session","useSingleton","Singleton","initialize","Firebase","SessionUser","shouldEndSessionOnError","changing","state","setState","load_error","apps","fn","mapp","_change","loadAuth","args","auth","setAuth","app","app_token","app_tokens","find","signInWithCustomToken","token","refresh","client_auth","end","clearAuth","signOut","action","FirebaseSession","unsubscribe","onAuthStateChanged","firebase_user","getIdToken","email","password","provider","provider_name","popup","provider_method","dedicated_providers","invalidMode","oauth_providers","credential","includes","signInWithEmailAndPassword","createUserWithEmailAndPassword","sendEmailVerification","Provider","domain","toLowerCase","OAuthProvider","_catch","NO_SESSION","refresh_token","getClient","uri","storage","storage_key","cache_options","readAuthFromStorage","new_auth","writeAuthToStorage","getItem","json","JSON","parse","http_link","HttpLink","auth_link","setContext","request","prev_context","headers","authorization","link","from","cache","InMemoryCache","ApolloClient","defaultOptions","stringify","setItem","getGraphQLErrorCode","graphQLErrors","extensions","code","getSubdomain","hostname","parts","split","last_index","last","length","is_localhost","slice","join","subdomainApps","map","main","item","getApp","window","location","subdomain","subdomains","Router","history","web","addEventListener","_onPopState","bind","routes","redirects","Groutcho","onGo","_onGo","input","url","pathname","search","_handleMatch","go","_normalizeInput","current","back","pop","push","pushState"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAEA,MAAMA,MAAM,GAAG,IAAIC,MAAJ,CAAW,MAAX,CAAf;;ECGA,MAAMD,QAAM,GAAGE,MAAW,CAACC,KAAZ,CAAkB,eAAlB,CAAf;;EAEA,SAASC,KAAT,OAAkD;EAAA,MAAlC;EAACC,IAAAA,OAAD;EAAUC,IAAAA,KAAV;EAAiBC,IAAAA;EAAjB,GAAkC;EAAA,MAARC,KAAQ;;EAChD,QAAM;EAACC,IAAAA,IAAD;EAAOC,IAAAA,MAAP;EAAeC,IAAAA;EAAf,MAAuBH,KAA7B;;EACA,sBAAuCD,IAAI,CAACK,KAAL,CAAW;EAACF,IAAAA,MAAD;EAASC,IAAAA;EAAT,GAAX,CAAvC;EAAA,QAAM;EAACC,IAAAA,KAAK,EAAEC;EAAR,GAAN;EAAA,QAA4BC,OAA5B;;EACA,QAAMF,KAAK,GAAGG,eAAQ,CAACF,SAAD,EAAYC,OAAZ,CAAtB;EACA,QAAM;EAACE,IAAAA,OAAD;EAAUC,IAAAA,KAAV;EAAiBC,IAAAA;EAAjB,MAAyBN,KAA/B;EAEAZ,EAAAA,QAAM,CAACmB,KAAP,CAAa,gCAAb,eAAmDX,KAAnD;EAA0DQ,IAAAA,OAA1D;EAAmEC,IAAAA,KAAnE;EAA0EC,IAAAA;EAA1E;;EAEA,MAAIF,OAAJ,EAAa;EACXhB,IAAAA,QAAM,CAACmB,KAAP,CAAc,yBAAwBV,IAAK,EAA3C;EACA,wBACEW,oBAAC,OAAD;EACE,MAAA,IAAI,EAAEb,IADR;EAEE,MAAA,KAAK,EAAEK;EAFT,OAGMJ,KAHN,EADF;EAOD,GATD,MASO,IAAIS,KAAJ,EAAW;EAChBjB,IAAAA,QAAM,CAACmB,KAAP,CAAc,uBAAsBV,IAAK,EAAzC;EACA,wBACEW,oBAAC,KAAD;EACE,MAAA,IAAI,EAAEb,IADR;EAEE,MAAA,KAAK,EAAEU,KAFT;EAGE,MAAA,KAAK,EAAEL;EAHT,OAIMJ,KAJN,EADF;EAQD,GAVM,MAUA;EACLR,IAAAA,QAAM,CAACmB,KAAP,CAAc,wBAAuBV,IAAK,EAA1C;EACA,wBACEW,oBAAC,IAAD;EACE,MAAA,IAAI,EAAEF,IADR;EAEE,MAAA,KAAK,EAAEN;EAFT,OAGMJ,KAHN,EADF;EAOD;EACF;;AAED,EAAO,SAASa,aAAT,CAAwBb,KAAxB,EAA+B;EACpC,QAAM;EAACc,IAAAA,KAAD;EAAQZ,IAAAA;EAAR,MAAkBF,KAAK,CAACe,KAA9B;EACA,QAAM;EAACC,IAAAA,IAAI,EAAEjB,IAAP;EAAaE,IAAAA;EAAb,MAAqBa,KAA3B;EAEA,QAAMG,UAAU,GAAG;EAACH,IAAAA,KAAD;EAAQZ,IAAAA,MAAR;EAAgBD,IAAAA;EAAhB,GAAnB;;EAEA,MAAIF,IAAI,CAACK,KAAT,EAAgB;EACd,wBACEQ,oBAAC,KAAD;EACE,MAAA,IAAI,EAAEb;EADR,OAEMC,KAFN,EAGMiB,UAHN,EADF;EAOD,GARD,MAQO;EACL,wBACEL,oBAAC,IAAD;EACE,MAAA,IAAI,EAAE,EADR;EAEE,MAAA,KAAK,EAAE;EAFT,OAGMZ,KAHN,EAIMiB,UAJN,EADF;EAQD;EACF;;EChEc,SAASC,oBAAT,OASZ;EAAA,MAT2C;EAC5CC,IAAAA,kBAD4C;EAE5CC,IAAAA,SAF4C;EAG5CC,IAAAA,WAH4C;EAI5CC,IAAAA,SAJ4C;EAK5CC,IAAAA,MAL4C;EAM5CC,IAAAA,SAN4C;EAO5CC,IAAAA;EAP4C,GAS3C;EAAA,MADEzB,KACF;;EACD,QAAMR,QAAM,GAAGE,MAAW,CAACC,KAAZ,CAAkB,sBAAlB,CAAf;EACAH,EAAAA,QAAM,CAACmB,KAAP,CAAa,gCAAb;EAEA,QAAMe,MAAM,GAAGF,SAAS,EAAxB;EACA,QAAMG,OAAO,GAAGF,UAAU,EAA1B;EACA,QAAM;EAACtB,IAAAA;EAAD,MAASwB,OAAf;EAEAC,EAAAA,eAAS,CAAC,MAAK;EACbpC,IAAAA,QAAM,CAACmB,KAAP,CAAa,iBAAb;EACAgB,IAAAA,OAAO,CAACE,IAAR;EACA,WAAO,MAAK;EACVrC,MAAAA,QAAM,CAACmB,KAAP,CAAa,mBAAb;EACAgB,MAAAA,OAAO,CAACG,MAAR;EACD,KAHD;EAID,GAPQ,EAON,EAPM,CAAT;EASAF,EAAAA,eAAS,CAAC,MAAK;EACbpC,IAAAA,QAAM,CAACmB,KAAP,CAAa,gBAAb,EAA+B;EAACR,MAAAA;EAAD,KAA/B;;EACA,QAAI,CAACwB,OAAO,CAACI,MAAb,EAAqB;EACnB;EACD;;EACD,UAAMhB,KAAK,GAAGW,MAAM,CAACM,KAAP,CAAa;EAAC7B,MAAAA;EAAD,KAAb,CAAd;;EACA,QAAIY,KAAJ,oBAAIA,KAAK,CAAEkB,QAAX,EAAqB;EACnB,YAAM;EAACnB,QAAAA;EAAD,UAAUC,KAAhB;EACA,UAAImB,GAAG,GAAG,cAAV;EACA,YAAMjC,IAAI,GAAGa,KAAH,oBAAGA,KAAK,CAAEb,IAApB;;EACA,UAAIA,IAAJ,EAAU;EACRiC,QAAAA,GAAG,GAAI,GAAEA,GAAI,OAAMjC,IAAK,EAAxB;EACD;;EACDT,MAAAA,QAAM,CAAC2C,IAAP,CAAYD,GAAZ,EAAiB;EAACnB,QAAAA;EAAD,OAAjB;EACD;EACF,GAfQ,EAeN,CAACZ,IAAD,CAfM,CAAT;;EAiBA,MAAIwB,OAAO,CAACI,MAAR,IAAkBL,MAAM,CAACX,KAA7B,EAAoC;EAClC,wBACEqB,6BAAC,SAAD;EACE,MAAA,KAAK,EAAEV,MAAM,CAACX;EADhB,oBAGEqB,6BAAC,aAAD;EACE,MAAA,OAAO,EAAEf,WADX;EAEE,MAAA,KAAK,EAAEC,SAFT;EAGE,MAAA,KAAK,EAAEI,MAAM,CAACX,KAHhB;EAIE,MAAA,MAAM,EAAEQ,MAJV;EAKE,MAAA,IAAI,EAAEpB;EALR,OAMMH,KANN,EAHF,CADF;EAcD,GAfD,MAeO;EACL,wBACEoC,6BAAC,kBAAD;EACE,MAAA,KAAK,EAAET,OAAO,CAAClB,KAAR,IAAiBiB,MAAM,CAACjB,KADjC;EAEE,MAAA,IAAI,EAAEN;EAFR,OAGMH,KAHN,EADF;EAOD;EACF;EAEDkB,oBAAoB,CAACmB,eAArB,GAAuC;EACrCC,EAAAA,oBAAoB,EAAE;EADe,CAAvC;EAIApB,oBAAoB,CAACqB,SAArB,GAAiC;EAC/BpB,EAAAA,kBAAkB,EAAEqB,SAAS,CAACC,IADC;EAE/BrB,EAAAA,SAAS,EAAEoB,SAAS,CAACC,IAFU;EAG/BpB,EAAAA,WAAW,EAAEmB,SAAS,CAACC,IAHQ;EAI/BnB,EAAAA,SAAS,EAAEkB,SAAS,CAACC,IAJU;EAK/BlB,EAAAA,MAAM,EAAEiB,SAAS,CAACE,MALa;EAM/BlB,EAAAA,SAAS,EAAEgB,SAAS,CAACC,IANU;EAO/BhB,EAAAA,UAAU,EAAEe,SAAS,CAACC;EAPS,CAAjC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECmeO,gBAAgBE,IAAhB,EAAsBC,OAAtB,EAA+B;EACrC,MAAI;EACH,QAAIC,MAAM,GAAGF,IAAI,EAAjB;EACA,GAFD,CAEE,OAAMG,CAAN,EAAS;EACV,WAAOF,OAAO,CAACE,CAAD,CAAd;EACA;;EACD,MAAID,MAAM,IAAIA,MAAM,CAACE,IAArB,EAA2B;EAC1B,WAAOF,MAAM,CAACE,IAAP,CAAY,KAAK,CAAjB,EAAoBH,OAApB,CAAP;EACA;;EACD,SAAOC,MAAP;EACA;;AAvjBD,EAAe,MAAMG,OAAN,SAAsBC,uBAAY,CAACC,SAAnC,CAA6C;EAC1DC,EAAAA,UAAU,GAAI;EACZ,UAAM;EACJC,MAAAA,QADI;EAEJC,MAAAA,WAFI;EAGJ9B,MAAAA,MAHI;EAIJ+B,MAAAA,uBAAuB,GAAG,MAAK;EAC7B,eAAO,IAAP;EACD;EANG,QAOF,KAAKhD,OAPT;EASA+C,IAAAA,WAAW,CAAC9B,MAAZ,GAAqBA,MAArB;EACA,UAAMpB,IAAI,GAAG,IAAIkD,WAAJ,EAAb;EAEA,SAAKD,QAAL,GAAgBA,QAAhB;EACA,SAAKC,WAAL,GAAmBA,WAAnB;EACA,SAAK9B,MAAL,GAAcA,MAAd;EACA,SAAK+B,uBAAL,GAA+BA,uBAA/B;EAEA,SAAK9D,MAAL,GAAcA,MAAM,CAACG,KAAP,CAAa;EACzBM,MAAAA,IAAI,EAAE,SADmB;EAEzBE,MAAAA;EAFyB,KAAb,CAAd;EAKA,WAAO;EACLA,MAAAA,IADK;EAELoD,MAAAA,QAAQ,EAAE,KAFL;EAGLxB,MAAAA,MAAM,EAAE,KAHH;EAILtB,MAAAA,KAAK,EAAE;EAJF,KAAP;EAMD;;EAED,MAAIN,IAAJ,GAAY;EACV,WAAO,KAAKqD,KAAL,CAAWrD,IAAlB;EACD;;EAED,MAAIA,IAAJ,CAAUO,IAAV,EAAgB;EACd,UAAMP,IAAI,GAAG,IAAI,KAAKkD,WAAT,CAAqB3C,IAArB,CAAb;EACA,SAAK+C,QAAL,CAAc;EAACtD,MAAAA;EAAD,KAAd;EACD;;EAED,MAAIoD,QAAJ,GAAgB;EACd,WAAO,KAAKC,KAAL,CAAWD,QAAlB;EACD;;EAED,MAAIxB,MAAJ,GAAc;EACZ,WAAO,KAAKyB,KAAL,CAAWzB,MAAlB;EACD;;EAED,MAAItB,KAAJ,GAAa;EACX,WAAO,KAAK+C,KAAL,CAAW/C,KAAlB;EACD;;EAED,MAAIiD,UAAJ,GAAkB;EAChB,WAAO,KAAK3B,MAAL,GAAc,IAAd,GAAqB,KAAKtB,KAAjC;EACD;;EAEDkD,EAAAA,IAAI,CAAEC,EAAF,EAAM;EACR,WAAOC,MAAI,CAAC,KAAKT,QAAL,CAAcO,IAAf,EAAqBC,EAArB,CAAX;EACD;;EAEK/B,EAAAA,IA7DoD;EAAA,QA6D5C;EAAA,oBACZ,IADY;;EACZ,YAAKrC,MAAL,CAAYmB,KAAZ,CAAkB,iBAAlB;;EACA,6BAAO,MAAKmD,OAAL;EAAA,YAAwB;EAAA,iCACvB,MAAKvC,MAAL,CAAYwC,QAAZ,EADuB;EAAA,mCAEV,MAAKV,WAAL,CAAiBxB,IAAjB,EAFU,iBAEvB1B,IAFuB;EAG7B,oBAAKX,MAAL,CAAYmB,KAAZ,CAAkB,gBAAlB,EAAoC;EAACR,gBAAAA;EAAD,eAApC;;EACA,qBAAO;EACLA,gBAAAA,IADK;EAEL4B,gBAAAA,MAAM,EAAE;EAFH,eAAP;EAJ6B;EAAA;EAQ9B,SARM;EAAA;EAAA;EAAA,QAAP;EASD,KAxEyD;EAAA;EAAA;EAAA;;EA0E1DD,EAAAA,MAAM,GAAI;;EAEVE,EAAAA,KAAK,CAAEgC,IAAF,EAAQ;EAAA,mBAGkB,IAHlB;;EACX,SAAKxE,MAAL,CAAYmB,KAAZ,CAAkB,kBAAlB;EACA,WAAO,KAAKmD,OAAL;EAAA,UAAwB;EAAA,+BACF,OAAKT,WAAL,CAAiBrB,KAAjB,CAAuBgC,IAAvB,CADE,iBACvB;EAAC7D,UAAAA,IAAD;EAAO8D,UAAAA;EAAP,SADuB;EAE7B,iBAAKzE,MAAL,CAAYmB,KAAZ,CAAkB,+BAAlB,EAAmD;EAACR,YAAAA;EAAD,WAAnD;;EAF6B,iCAGvB,OAAKoB,MAAL,CAAY2C,OAAZ,CAAoBD,IAApB,CAHuB;EAAA,mCAIvB,OAAKN,IAAL,CAAWQ,GAAD,IAAQ;EACtB,oBAAMC,SAAS,GAAGH,IAAI,CAACI,UAAL,CAAgBC,IAAhB,CAAqB,CAAC;EAACrE,gBAAAA;EAAD,eAAD,KAAWA,IAAI,KAAKkE,GAAG,CAAClE,IAA7C,CAAlB;;EACA,kBAAI,CAACmE,SAAL,EAAgB;EACd,uBAAO,IAAP;EACD;;EACD,qBAAOD,GAAG,CAACF,IAAJ,GAAWM,qBAAX,CAAiCH,SAAS,CAACI,KAA3C,CAAP;EACD,aANK,CAJuB;EAW7B,qBAAO;EAACrE,gBAAAA;EAAD,eAAP;EAX6B;EAAA;EAAA;EAY9B,OAZM;EAAA;EAAA;EAAA,MAAP;EAaD;;EAEDsE,EAAAA,OAAO,GAAI;EAAA,mBASU,IATV;;EACT,UAAM;EAACpB,MAAAA;EAAD,QAAgB,IAAtB;;EACA,QAAI,CAACA,WAAW,CAACoB,OAAjB,EAA0B;EACxB,WAAKjF,MAAL,CAAYmB,KAAZ,CAAkB,0CAAlB;EACA,aAAO,IAAP;EACD;;EAED,SAAKnB,MAAL,CAAYmB,KAAZ,CAAkB,oBAAlB;EACA,WAAO,KAAKmD,OAAL;EAAA,UAAwB;EAC7B,cAAM;EAACvC,UAAAA;EAAD,kBAAN;EAD6B,+BAEHA,MAAM,CAACwC,QAAP,EAFG,iBAEvBW,WAFuB;EAAA,iCAGVrB,WAAW,CAACoB,OAAZ,CAAoBC,WAApB,CAHU,iBAGvBhE,IAHuB;EAI7B,kBAAM;EAACP,cAAAA,IAAD;EAAO8D,cAAAA;EAAP,gBAAevD,IAArB;;EACA,mBAAKlB,MAAL,CAAYmB,KAAZ,CAAkB,iCAAlB,EAAqD;EAACR,cAAAA;EAAD,aAArD;;EAL6B,mCAMvBoB,MAAM,CAAC2C,OAAP,CAAeD,IAAf,CANuB;EAO7B,qBAAO;EAAC9D,gBAAAA;EAAD,eAAP;EAP6B;EAAA;EAAA;EAQ9B,OARM;EAAA;EAAA;EAAA,MAAP;EASD;;EAEDwE,EAAAA,GAAG,CAAEX,IAAF,EAAQ;EAAA,mBAML,IANK;;EACT,UAAM;EAACX,MAAAA;EAAD,QAAgB,IAAtB;EACA,SAAK7D,MAAL,CAAYmB,KAAZ,CAAkB,gBAAlB;EACA,WAAO,KAAKmD,OAAL;EAAA,UAAwB;EAAA;EAAA,iCAOvB,OAAKvC,MAAL,CAAYqD,SAAZ,EAPuB;EAAA,mCAQvB,OAAKjB,IAAL,CAAWQ,GAAD,IAAQ;EACtBA,cAAAA,GAAG,CAACF,IAAJ,GAAWY,OAAX;EACD,aAFK,CARuB;EAW7B,oBAAM1E,IAAI,GAAG,IAAIkD,WAAJ,EAAb;EACA,qBAAO;EAAClD,gBAAAA;EAAD,eAAP;EAZ6B;EAAA;EAAA;;EAAA,yCACzB;EAAA,iCACIkD,WAAW,CAACsB,GAAZ,CAAgBX,IAAhB,CADJ;EAEF,mBAAKxE,MAAL,CAAYmB,KAAZ,CAAkB,eAAlB;EAFE;EAGH,SAJ4B,YAIpBF,KAJoB,EAIb;EACd,iBAAKjB,MAAL,CAAYiB,KAAZ,CAAkB,sBAAlB,EAA0CA,KAA1C;EACD,SAN4B;;EAAA;EAa9B,OAbM;EAAA;EAAA;EAAA,MAAP;EAcD;;EAEKqD,EAAAA,OAnIoD,CAmI3CgB,MAnI2C;EAAA,QAmInC;EAAA,qBAChB,IADgB;;EACrB,UAAI,CAAC,OAAKvB,QAAV,EAAoB;EAClB,eAAKE,QAAL,CAAc;EAACF,UAAAA,QAAQ,EAAE;EAAX,SAAd;EACD;;EAHoB,wCAKjB;EAAA,+BACkBuB,MAAM,EADxB,iBACItB,KADJ;EAEF,iBAAKC,QAAL;EACEF,YAAAA,QAAQ,EAAE,KADZ;EAEE9C,YAAAA,KAAK,EAAE;EAFT,aAGK+C,KAHL;EAFE;EAOH,OAZoB,YAYZ/C,KAZY,EAYL;EAAA;EAQd,iBAAKgD,QAAL,CAAc;EACZF,YAAAA,QAAQ,EAAE,KADE;EAEZpD,YAAAA,IAFY;EAGZM,YAAAA;EAHY,WAAd;EARc;;EACd,eAAKjB,MAAL,CAAYiB,KAAZ,CAAkB,eAAlB,EAAmC;EAACA,UAAAA;EAAD,SAAnC;;EACA,YAAI;EAACN,UAAAA;EAAD,kBAAJ;;EAFc;EAAA,cAGV,OAAKmD,uBAAL,CAA6B7C,KAA7B,CAHU;EAIZ,mBAAKjB,MAAL,CAAYmB,KAAZ,CAAkB,2BAAlB;;EAJY,mCAKN,OAAKY,MAAL,CAAYqD,SAAZ,EALM;EAMZzE,cAAAA,IAAI,GAAG,IAAP;EANY;EAAA;EAAA;;EAAA;EAaf,OAzBoB;;EAAA;EA0BtB,KA7JyD;EAAA;EAAA;EAAA;;EAAA;;EC6iBrD,kBAAgBwC,IAAhB,EAAsBC,OAAtB,EAA+B;EACrC,MAAI;EACH,QAAIC,MAAM,GAAGF,IAAI,EAAjB;EACA,GAFD,CAEE,OAAMG,CAAN,EAAS;EACV,WAAOF,OAAO,CAACE,CAAD,CAAd;EACA;;EACD,MAAID,MAAM,IAAIA,MAAM,CAACE,IAArB,EAA2B;EAC1B,WAAOF,MAAM,CAACE,IAAP,CAAY,KAAK,CAAjB,EAAoBH,OAApB,CAAP;EACA;;EACD,SAAOC,MAAP;EACA;;AA1jBD,EAAe,MAAMkC,eAAN,SAA8B/B,OAA9B,CAAsC;EACnD,MAAIiB,IAAJ,GAAY;EACV,WAAO,KAAKb,QAAL,CAAca,IAAd,EAAP;EACD;;EAEKpC,EAAAA,IAL6C;EAAA,QAKrC;EAAA,oBACZ,IADY;;EACZ,YAAKrC,MAAL,CAAYmB,KAAZ,CAAkB,iBAAlB;;EAEA,YAAK8C,QAAL,CAAc;EAACF,QAAAA,QAAQ,EAAE;EAAX,OAAd;;EAEA,YAAM;EAACF,QAAAA,WAAD;EAAc9B,QAAAA;EAAd,eAAN;EACA,YAAKyD,WAAL,GAAmB,MAAKf,IAAL,CAAUgB,kBAAV,WAAoCC,aAApC;EAAA,YAAqD;EACtE,gBAAK1F,MAAL,CAAYmB,KAAZ,CAAkB,6BAAlB,EAAiD;EAACuE,YAAAA;EAAD,WAAjD;;EADsE,iCAEhE,MAAKpB,OAAL;EAAA,gBAAwB;EAAA;EAa5B,uBAAO;EAAC3D,kBAAAA,IAAD;EAAO4B,kBAAAA,MAAM,EAAE;EAAf,iBAAP;EAb4B;;EAC5B,kBAAI5B,IAAJ;;EAD4B;EAAA,oBAExB+E,aAFwB;EAG1B,wBAAK1F,MAAL,CAAYmB,KAAZ,CAAkB,6BAAlB;;EAH0B,yCAINuE,aAAa,CAACC,UAAd,CAAyB,IAAzB,CAJM,iBAIpBX,KAJoB;EAK1BjD,oBAAAA,MAAM,CAAC2C,OAAP,CAAe;EAACM,sBAAAA;EAAD,qBAAf;;EACA,0BAAKhF,MAAL,CAAYmB,KAAZ,CAAkB,sBAAlB;;EAN0B,2CAOb0C,WAAW,CAACxB,IAAZ,CAAiB;EAACN,sBAAAA,MAAD;EAASiD,sBAAAA,KAAT;EAAgBU,sBAAAA;EAAhB,qBAAjB,CAPa;EAO1B/E,sBAAAA,IAAI,oBAAJ;EAP0B;EAAA;EAAA;EAS1B,wBAAKX,MAAL,CAAYmB,KAAZ,CAAkB,mCAAlB;;EAT0B,yCAUpBY,MAAM,CAACqD,SAAP,EAVoB;EAW1BzE,oBAAAA,IAAI,GAAG,IAAIkD,WAAJ,EAAP;EAX0B;EAAA;EAAA;;EAAA;EAc7B,aAdK;EAAA;EAAA;EAAA,YAFgE;EAiBvE,SAjBkB;EAAA;EAAA;EAAA,QAAnB;EANY;EAwBb,KA7BkD;EAAA;EAAA;EAAA;;EA+B7CvB,EAAAA,MA/B6C;EAAA,QA+BnC;EAAA,qBACd,IADc;;EACd,aAAKtC,MAAL,CAAYmB,KAAZ,CAAkB,2CAAlB;;EACA,aAAKqE,WAAL;;EAFc;EAGf,KAlCkD;EAAA;EAAA;EAAA;;EAoC7ChD,EAAAA,KApC6C,CAoCtC;EACXoD,IAAAA,KADW;EAEXC,IAAAA,QAFW;EAGXC,IAAAA,QAAQ,EAAEC,aAHC;EAIXC,IAAAA,KAAK,GAAG;EAJG,GApCsC;EAAA,QAyChD;EAAA,qBASwB,IATxB;;EACD,YAAMC,eAAe,GAAGD,KAAK,GAAG,iBAAH,GAAuB,oBAApD;EACA,YAAME,mBAAmB,GAAG,CAAC,QAAD,EAAW,UAAX,EAAuB,SAAvB,EAAkC,QAAlC,CAA5B;;EAGA,eAASC,WAAT,GAAwB;EACtB,cAAM,IAAI7F,KAAJ,CAAW,sBAAqByF,aAAc,EAA9C,CAAN;EACD;;EAJD,YAAMK,eAAe,GAAG,CAAC,OAAD,EAAU,WAAV,EAAuB,OAAvB,CAAxB;EAMA,YAAM;EAACxC,QAAAA,QAAD;EAAWa,QAAAA;EAAX,gBAAN;EATC,kDAWG;EACF,YAAI4B,UAAJ;;EADE;EAAA,cAEEN,aAAa,CAACO,QAAd,CAAuB,OAAvB,CAFF;EAAA;EAAA,kBAGIP,aAAa,KAAK,aAHtB;EAIE,uBAAK/F,MAAL,CAAYmB,KAAZ,CAAkB,uBAAlB,EAA2C;EAACyE,kBAAAA;EAAD,iBAA3C;;EAJF,uCAKqBnB,IAAI,CAAC8B,0BAAL,CAAgCX,KAAhC,EAAuCC,QAAvC,CALrB;EAKEQ,kBAAAA,UAAU,wBAAV;EALF;EAAA;EAAA;EAAA,sBAMWN,aAAa,KAAK,aAN7B;EAOE,2BAAK/F,MAAL,CAAYmB,KAAZ,CAAkB,uBAAlB,EAA2C;EAACyE,sBAAAA;EAAD,qBAA3C;;EAPF,2CAQqBnB,IAAI,CAAC+B,8BAAL,CAAoCZ,KAApC,EAA2CC,QAA3C,CARrB;EAQEQ,sBAAAA,UAAU,wBAAV;;EACA,6BAAKrG,MAAL,CAAYmB,KAAZ,CAAkB,oCAAlB;;EATF,6CAUQkF,UAAU,CAAC1F,IAAX,CAAgB8F,qBAAhB,EAVR;EAAA;EAAA;EAYEN,oBAAAA,WAAW;EAZb;EAAA;;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA,kBAcSD,mBAAmB,CAACI,QAApB,CAA6BP,aAA7B,CAdT;EAeA,sBAAMW,QAAQ,GAAG9C,QAAQ,CAACa,IAAT,CAAe,GAAEsB,aAAc,cAA/B,CAAjB;EACA,sBAAMD,QAAQ,GAAG,IAAIY,QAAJ,EAAjB;;EACA,uBAAK1G,MAAL,CAAYmB,KAAZ,CAAkB,oCAAlB,EAAwD;EAAC4E,kBAAAA,aAAD;EAAgBE,kBAAAA;EAAhB,iBAAxD;;EAjBA,uCAkBmBxB,IAAI,CAACwB,eAAD,CAAJ,CAAsBH,QAAtB,CAlBnB;EAkBAO,kBAAAA,UAAU,wBAAV;EAlBA;EAAA;EAAA;EAAA,sBAmBSD,eAAe,CAACE,QAAhB,CAAyBP,aAAzB,CAnBT;EAoBA,0BAAMY,MAAM,GAAI,GAAEZ,aAAa,CAACa,WAAd,EAA4B,MAA9C;EACA,0BAAMd,QAAQ,GAAG,IAAIlC,QAAQ,CAACa,IAAT,CAAcoC,aAAlB,CAAgCF,MAAhC,CAAjB;;EACA,2BAAK3G,MAAL,CAAYmB,KAAZ,CAAkB,gCAAlB,EAAoD;EAACwF,sBAAAA,MAAD;EAASV,sBAAAA;EAAT,qBAApD;;EAtBA,2CAuBmBxB,IAAI,CAACwB,eAAD,CAAJ,CAAsBH,QAAtB,CAvBnB;EAuBAO,sBAAAA,UAAU,yBAAV;EAvBA;EAAA;EAyBAF,oBAAAA,WAAW;EAzBX;EAAA;;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;;EAAA;EA2BF,iBAAOE,UAAP;EA3BE,aA2BKA,UA3BL;EA4BH,OAvCA,YAuCQpF,KAvCR,EAuCe;EACd,eAAKjB,MAAL,CAAYmB,KAAZ,CAAkB,sBAAlB,EAA0CF,KAA1C;;EACA,cAAMA,KAAN;EACD,OA1CA;EA2CF,KApFkD;EAAA;EAAA;EAAA;;EAsF7CkE,EAAAA,GAtF6C;EAAA,QAsFtC;EAAA,qBACX,IADW;;EACX,aAAKlB,QAAL,CAAc;EAACF,QAAAA,QAAQ,EAAE;EAAX,OAAd;;EACA,6BAAO,OAAKU,IAAL,CAAUY,OAAV,EAAP;EACD,KAzFkD;EAAA;EAAA;EAAA;;EAAA;;ECgjB9C,SAASyB,QAAT,CAAgB3D,IAAhB,EAAsBC,OAAtB,EAA+B;EACrC,MAAI;EACH,QAAIC,MAAM,GAAGF,IAAI,EAAjB;EACA,GAFD,CAEE,OAAMG,CAAN,EAAS;EACV,WAAOF,OAAO,CAACE,CAAD,CAAd;EACA;;EACD,MAAID,MAAM,IAAIA,MAAM,CAACE,IAArB,EAA2B;EAC1B,WAAOF,MAAM,CAACE,IAAP,CAAY,KAAK,CAAjB,EAAoBH,OAApB,CAAP;EACA;;EACD,SAAOC,MAAP;EACA;;EAljBD,MAAM0D,UAAU,GAAG;EACjB/B,EAAAA,KAAK,EAAE,IADU;EAEjBgC,EAAAA,aAAa,EAAE;EAFE,CAAnB;EAKA,IAAIvC,IAAI,GAAG,IAAX;AAEA,EAAe,SAASwC,SAAT,CAAoB;EACjCC,EAAAA,GADiC;EAEjCC,EAAAA,OAFiC;EAGjCC,EAAAA,WAAW,GAAG,WAHmB;EAIjCtG,EAAAA,OAAO,GAAG,EAJuB;EAKjCuG,EAAAA,aAAa,GAAG;EALiB,CAApB,EAMZ;EAAA,QA2DcjC,SA3Dd;EAAA,QA2D2B;EAC1BpF,MAAAA,QAAM,CAACmB,KAAP,CAAa,uBAAb;EACAuD,MAAAA,OAAO,CAACqC,UAAD,CAAP;EAF0B;EAG3B,KA9DA;EAAA;EAAA;EAAA;;EAAA,QAkDcxC,QAlDd;EAAA,QAkD0B;EACzB,UAAI,CAAC4C,OAAL,EAAc;EACZ,cAAM,IAAI7G,KAAJ,CAAU,wCAAV,CAAN;EACD;;EACDN,MAAAA,QAAM,CAACmB,KAAP,CAAa,sBAAb;EAJyB,6BAKZmG,mBAAmB,EALP;EAKzB7C,QAAAA,IAAI,uBAAJ;EACA,eAAOA,IAAP;EANyB;EAO1B,KAzDA;EAAA;EAAA;EAAA;;EAAA,QA0CcC,OA1Cd,aA0CuB6C,QA1CvB;EAAA,QA0CiC;EAAA;EAKhC9C,QAAAA,IAAI,GAAG8C,QAAP;EALgC;;EAChCvH,MAAAA,QAAM,CAACmB,KAAP,CAAa,sBAAb;;EADgC;EAAA,YAE5BgG,OAF4B;EAAA,iCAGxBK,kBAAkB,CAACD,QAAD,CAHM;EAAA;EAAA;;EAAA;EAMjC,KAhDA;EAAA;EAAA;EAAA;;EAAA,QA8BcD,mBA9Bd;EAAA,QA8BqC;EACpCtH,MAAAA,QAAM,CAACmB,KAAP,CAAa,2BAAb;EACA,UAAIsD,IAAJ;;EAFoC,0CAGhC;EAAA,+BACiB0C,OAAO,CAACM,OAAR,CAAgBL,WAAhB,CADjB,iBACIM,IADJ;EAEFjD,UAAAA,IAAI,GAAGkD,IAAI,CAACC,KAAL,CAAWF,IAAX,KAAoBX,UAA3B;EAFE;EAGH,OANmC,cAMpB;EACdtC,QAAAA,IAAI,GAAGsC,UAAP;EACD,OARmC;;EAAA;EASpC,eAAOtC,IAAP;EAToC,WAS7BA,IAT6B;EAUrC,KAxCA;EAAA;EAAA;EAAA;;EACD,QAAMzE,QAAM,GAAGE,MAAW,CAACC,KAAZ,CAAkB;EAACM,IAAAA,IAAI,EAAE,WAAP;EAAoByG,IAAAA;EAApB,GAAlB,CAAf;EAEAlH,EAAAA,QAAM,CAAC2C,IAAP,CAAY,gBAAZ;EAEA,QAAMkF,SAAS,GAAG,IAAIC,eAAJ,CAAa;EAACZ,IAAAA;EAAD,GAAb,CAAlB;EAEA,QAAMa,SAAS,GAAGC,kBAAU,WAAQC,OAAR,EAAiBC,YAAjB;EAAA,QAAiC;EAAA;EAK3D,cAAM;EAAClD,UAAAA;EAAD,YAAUP,IAAhB;;EACA,YAAIO,KAAJ,EAAW;EACThF,UAAAA,QAAM,CAACmB,KAAP,CAAa,6BAAb;EACAgH,UAAAA,OAAO,CAACC,aAAR,GAAwBpD,KAAK,GAAI,UAASA,KAAM,EAAnB,GAAuB,EAApD;EACD;;EACD,eAAO;EAACmD,UAAAA;EAAD,SAAP;EAV2D;;EAC3D,YAAM;EAACA,QAAAA,OAAO,GAAG;EAAX,UAAiBD,YAAvB;;EAD2D;EAAA,YAEvD,CAACzD,IAFsD;EAAA,iCAGnDF,QAAQ,EAH2C;EAAA;EAAA;;EAAA;EAW5D,KAX2B;EAAA;EAAA;EAAA,IAA5B;EAaA,QAAM8D,IAAI,GAAGC,WAAI,CAAC,CAACP,SAAD,EAAYF,SAAZ,CAAD,CAAjB;EACA,QAAMU,KAAK,GAAG,IAAIC,oBAAJ,CAAkBnB,aAAlB,CAAd;EACA,QAAMtF,QAAM,GAAG,IAAI0G,mBAAJ,CAAiB;EAACJ,IAAAA,IAAD;EAAOE,IAAAA,KAAP;EAAcG,IAAAA,cAAc,EAAE5H;EAA9B,GAAjB,CAAf;;EAEA,WAAS0G,kBAAT,CAA6B/C,IAA7B,EAAmC;EACjCzE,IAAAA,QAAM,CAACmB,KAAP,CAAa,yBAAb;EACA,UAAMuG,IAAI,GAAGC,IAAI,CAACgB,SAAL,CAAelE,IAAf,CAAb;EACA,WAAO0C,OAAO,CAACyB,OAAR,CAAgBxB,WAAhB,EAA6BM,IAA7B,CAAP;EACD;;EAoCD3F,EAAAA,QAAM,CAAC2C,OAAP,GAAiBA,OAAjB;EACA3C,EAAAA,QAAM,CAACwC,QAAP,GAAkBA,QAAlB;EACAxC,EAAAA,QAAM,CAACqD,SAAP,GAAmBA,SAAnB;EAEA,SAAOrD,QAAP;EACD;;EC5Fc,SAAS8G,mBAAT,CAA8B5H,KAA9B,EAAqC;EAAA;;EAClD,MAAIA,KAAK,CAAC6H,aAAV,EAAyB;EACtB,KAAC7H,KAAD,IAAUA,KAAK,CAAC6H,aAAjB;EACD;;EACD,mBAAO7H,KAAP,0CAAO,OAAO8H,UAAd,qBAAO,kBAAmBC,IAA1B;EACD;;ECLc,SAASC,YAAT,CAAuBC,QAAvB,EAAiC;EAC9C,QAAMC,KAAK,GAAGD,QAAQ,CAACE,KAAT,CAAe,GAAf,CAAd;EAEA,MAAIC,UAAU,GAAG,CAAC,CAAlB;EACA,QAAMC,IAAI,GAAGH,KAAK,CAACA,KAAK,CAACI,MAAN,GAAe,CAAhB,CAAlB;EACA,QAAMC,YAAY,GAAGF,IAAI,KAAK,WAA9B;;EACA,MAAIE,YAAJ,EAAkB;EAChBH,IAAAA,UAAU,GAAG,CAAC,CAAd;EACD;;EAED,SAAOF,KAAK,CAACM,KAAN,CAAY,CAAZ,EAAeJ,UAAf,EAA2BK,IAA3B,CAAgC,GAAhC,CAAP;EACD;;ECTc,SAASC,aAAT,CAAwBC,GAAxB,EAA6B;EAC1C,QAAMC,IAAI,GAAGD,GAAG,CAAC9E,IAAJ,CAAUgF,IAAD,IAASA,IAAI,CAACD,IAAvB,CAAb;;EACA,MAAI,CAACA,IAAL,EAAW;EACT,UAAM,IAAIvJ,KAAJ,CAAU,0DAAV,CAAN;EACD;;EAED,SAAO,SAASyJ,MAAT,GAAmB;EACxB,UAAM;EAACb,MAAAA;EAAD,QAAac,MAAM,CAACC,QAA1B;EACA,UAAMC,SAAS,GAAGjB,YAAY,CAACC,QAAD,CAA9B;;EAEA,QAAI,CAACgB,SAAL,EAAgB;EACd,aAAOL,IAAI,CAAClF,GAAZ;EACD;;EAED,UAAMA,GAAG,GAAGiF,GAAG,CAAC9E,IAAJ,CAAS,CAAC;EAACqF,MAAAA;EAAD,KAAD,KAAiBA,UAAU,CAAC7D,QAAX,CAAoB4D,SAApB,CAA1B,CAAZ;;EACA,QAAIvF,GAAJ,EAAS;EACP,aAAOA,GAAG,CAACA,GAAX;EACD,KAFD,MAEO;EACL,aAAOkF,IAAI,CAAClF,GAAZ;EACD;EACF,GAdD;EAeD;;EClBc,MAAMyF,MAAN,SAAqB3G,uBAAY,CAACC,SAAlC,CAA4C;EACzDC,EAAAA,UAAU,GAAI;EACZ,SAAK0G,OAAL,GAAe,EAAf;;EAEA,QAAK,SAAS,KAAKvJ,OAAnB,EAA6B;EAC3B,WAAKwJ,GAAL,GAAW,KAAKxJ,OAAL,CAAawJ,GAAxB;EACD,KAFD,MAEO;EACL,WAAKA,GAAL,GAAW,CAAC,EAAEN,MAAM,IAAIA,MAAM,CAACC,QAAjB,IAA6BD,MAAM,CAACK,OAAtC,CAAZ;EACD;;EAED,QAAI,KAAKC,GAAT,EAAc;EACZN,MAAAA,MAAM,CAACO,gBAAP,CAAwB,UAAxB,EAAoC,KAAKC,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAApC;EACD;;EAED,UAAM;EAACC,MAAAA,MAAD;EAASC,MAAAA;EAAT,QAAsB,KAAK7J,OAAjC;EACA,SAAKoB,MAAL,GAAc,IAAI0I,QAAQ,CAACR,MAAb,CAAoB;EAACM,MAAAA,MAAD;EAASC,MAAAA;EAAT,KAApB,CAAd;EACA,SAAKzI,MAAL,CAAY2I,IAAZ,CAAiB,KAAKC,KAAL,CAAWL,IAAX,CAAgB,IAAhB,CAAjB;EAEA,SAAKzK,MAAL,GAAcA,MAAM,CAACG,KAAP,CAAa;EACzBM,MAAAA,IAAI,EAAE,QADmB;EAEzB6J,MAAAA,GAAG,EAAE,KAAKA;EAFe,KAAb,CAAd;EAKA,SAAKtK,MAAL,CAAYmB,KAAZ,CAAkB,qBAAlB;EAEA,WAAO;EACLI,MAAAA,KAAK,EAAE,IADF;EAELN,MAAAA,KAAK,EAAE,IAFF;EAGL8J,MAAAA,KAAK,EAAE;EAHF,KAAP;EAKD;;EAED,MAAIC,GAAJ,GAAW;EAAA;;EACT,0BAAO,KAAKzJ,KAAZ,qBAAO,YAAYyJ,GAAnB;EACD;;EAED,MAAI/J,KAAJ,GAAa;EACX,WAAO,KAAK+C,KAAL,CAAW/C,KAAlB;EACD;;EAED,MAAIM,KAAJ,GAAa;EACX,WAAO,KAAKyC,KAAL,CAAWzC,KAAlB;EACD;;EAED,MAAID,KAAJ,GAAa;EAAA;;EACX,2BAAO,KAAKC,KAAZ,qBAAO,aAAYD,KAAnB;EACD;;EAED,MAAIZ,MAAJ,GAAc;EAAA;;EACZ,2BAAO,KAAKa,KAAZ,qBAAO,aAAYb,MAAnB;EACD;;EAED,MAAIc,IAAJ,GAAY;EAAA;;EACV,0BAAO,KAAKF,KAAZ,qBAAO,YAAYE,IAAnB;EACD;;EAED,MAAIuJ,KAAJ,GAAa;EACX,WAAO,KAAK/G,KAAL,CAAW+G,KAAlB;EACD;;EAEDvI,EAAAA,KAAK,OAAmB;EAAA,QAAjB;EAACwI,MAAAA;EAAD,KAAiB;EAAA,QAARD,KAAQ;;EACtB,QAAI,CAACC,GAAL,EAAU;EACRA,MAAAA,GAAG,GAAG,GAAN;;EACA,UAAI,KAAKV,GAAT,EAAc;EACZ,cAAM;EAACL,UAAAA;EAAD,YAAaD,MAAnB;EACA,cAAM;EAACiB,UAAAA,QAAD;EAAWC,UAAAA;EAAX,YAAqBjB,QAA3B;EACAe,QAAAA,GAAG,GAAI,GAAEC,QAAS,GAAEC,MAAO,EAA3B;EACD;EACF;;EACD,UAAM3J,KAAK,GAAG,KAAKW,MAAL,CAAYX,KAAZ,cAAsBwJ,KAAtB;EAA6BC,MAAAA;EAA7B,OAAd;;EACA,SAAKG,YAAL,CAAkB;EAAC5J,MAAAA,KAAD;EAAQwJ,MAAAA;EAAR,KAAlB;;EACA,WAAOxJ,KAAP;EACD;;EAED6J,EAAAA,EAAE,CAAE5G,IAAF,EAAQ;EACRA,IAAAA,IAAI,gBACC,KAAKuG,KADN,EAEC,KAAK7I,MAAL,CAAYmJ,eAAZ,CAA4B7G,IAA5B,CAFD,CAAJ;EAIA,SAAKxE,MAAL,CAAYmB,KAAZ,CAAkB,kBAAlB,EAAsC;EAACqD,MAAAA,IAAD;EAAO8G,MAAAA,OAAO,EAAE,KAAKN;EAArB,KAAtC;EACA,SAAK9I,MAAL,CAAYkJ,EAAZ,CAAe5G,IAAf;EACD;;EAED+G,EAAAA,IAAI,GAAI;EACN,UAAMvH,KAAK,GAAG,KAAKqG,OAAL,CAAamB,GAAb,EAAd;;EACA,QAAI,CAACxH,KAAL,EAAY;EACV;EACD;;EACD,QAAI,KAAKsG,GAAT,EAAc;EACZN,MAAAA,MAAM,CAACK,OAAP,CAAekB,IAAf;EACD,KAFD,MAEO;EACL,WAAKf,WAAL,CAAiB;EAACxG,QAAAA;EAAD,OAAjB;EACD;EACF;;EAEDmH,EAAAA,YAAY,CAAE;EAAC5J,IAAAA,KAAD;EAAQwJ,IAAAA;EAAR,GAAF,EAAkB;EAC5B,SAAK/K,MAAL,CAAYmB,KAAZ,CAAkB,uBAAlB,EAA2C;EAACI,MAAAA,KAAD;EAAQwJ,MAAAA;EAAR,KAA3C;;EACA,QAAIxJ,KAAJ,EAAW;EACT,UAAIA,KAAK,CAACyJ,GAAN,KAAc,KAAKA,GAAvB,EAA4B;EAC1B,cAAMhH,KAAK,GAAG;EAACgH,UAAAA,GAAG,EAAEzJ,KAAK,CAACyJ;EAAZ,SAAd;EACA,aAAKX,OAAL,CAAaoB,IAAb,CAAkBzH,KAAlB;;EACA,YAAI,KAAKsG,GAAT,EAAc;EACZN,UAAAA,MAAM,CAACK,OAAP,CAAeqB,SAAf,CAAyB1H,KAAzB,EAAgC,EAAhC,EAAoCzC,KAAK,CAACyJ,GAA1C;EACD;;EACD,aAAK/G,QAAL,CAAc;EAAC1C,UAAAA,KAAD;EAAQwJ,UAAAA,KAAR;EAAe9J,UAAAA,KAAK,EAAE;EAAtB,SAAd;EACD;EACF,KATD,MASO;EACL,YAAMA,KAAK,GAAG,IAAIX,KAAJ,CAAU,sBAAV,CAAd;EACA,WAAK2D,QAAL,CAAc;EAAC1C,QAAAA,KAAD;EAAQwJ,QAAAA,KAAR;EAAe9J,QAAAA;EAAf,OAAd;EACD;EACF;;EAED6J,EAAAA,KAAK,CAAEvJ,KAAF,EAAS;EACZ,SAAKvB,MAAL,CAAYmB,KAAZ,CAAkB,oBAAlB,EAAwC;EAACI,MAAAA;EAAD,KAAxC;EACA,UAAM;EAACwJ,MAAAA;EAAD,QAAU,IAAhB;;EACA,SAAKI,YAAL,CAAkB;EAAC5J,MAAAA,KAAD;EAAQwJ,MAAAA;EAAR,KAAlB;;EACA,UAAM;EAACF,MAAAA;EAAD,QAAS,KAAK/J,OAApB;;EACA,QAAI+J,IAAJ,EAAU;EACRA,MAAAA,IAAI,CAAC,KAAK7G,KAAN,CAAJ;EACD;EACF;;EAEDwG,EAAAA,WAAW,CAAE;EAACxG,IAAAA;EAAD,GAAF,EAAW;EACpB,UAAM;EAACgH,MAAAA;EAAD,QAAQhH,KAAd;EACA,UAAM;EAAC+G,MAAAA;EAAD,QAAU,IAAhB;EACA,UAAMxJ,KAAK,GAAG,KAAKW,MAAL,CAAYX,KAAZ,cAAsBwJ,KAAtB;EAA6BC,MAAAA;EAA7B,OAAd;;EACA,QAAIzJ,KAAJ,EAAW;EACT,WAAK0C,QAAL,CAAc;EAAC1C,QAAAA,KAAD;EAAQwJ,QAAAA,KAAR;EAAe9J,QAAAA,KAAK,EAAE;EAAtB,OAAd;EACD,KAFD,MAEO;EACL,YAAMA,KAAK,GAAG,IAAIX,KAAJ,CAAU,sBAAV,CAAd;EACA,WAAK2D,QAAL,CAAc;EAAC1C,QAAAA,KAAD;EAAQwJ,QAAAA,KAAR;EAAe9J,QAAAA;EAAf,OAAd;EACD;EACF;;EApIwD;;;;;;;;;;;;;;;;;;;;;;;;"}