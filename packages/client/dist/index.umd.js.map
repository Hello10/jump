{"version":3,"file":"index.umd.js","sources":["../src/getGraphQLErrorCode.js","../src/Session.js","../src/getClient.js","../src/firebaseConfig.js","../src/PageContainer.js","../src/subdomainApps.js"],"sourcesContent":["import get from 'lodash.get';\n\nexport default function getGraphQLErrorCode (error) {\n  let code = get(error, 'graphQLErrors[0].extensions.code', null);\n  if (!code) {\n    code = get(error, 'networkError.result.errors[0].extensions.code', null);\n  }\n  return code;\n}\n","import * as React from 'react';\nimport {\n  createContext,\n  useContext,\n  useState,\n  useEffect\n} from 'react';\nimport PropTypes from 'prop-types';\nimport Firebase from 'firebase/app';\nimport 'firebase/auth';\n\nimport getGraphQLErrorCode from './getGraphQLErrorCode';\n\nconst SessionContext = createContext();\n\nfunction SessionProvider ({client, children, SessionUser, Loading, popup = true}) {\n  const [loaded, setLoaded] = useState(false);\n  const [error, setError] = useState(null);\n  const [user, _setUser] = useState(new SessionUser(null));\n\n  function setUser (data) {\n    const user = new SessionUser(data);\n    _setUser(user);\n  }\n\n  useEffect(()=> {\n    const auth = Firebase.auth();\n    const unsubscribe = auth.onAuthStateChanged(async (firebase_user)=> {\n      try {\n        if (firebase_user) {\n          const token = await firebase_user.getIdToken(true);\n          client.setToken(token);\n          const user = await SessionUser.load({client, token, firebase_user});\n          setUser(user);\n        } else {\n          client.clearToken();\n          setUser(null);\n        }\n      } catch (error) {\n        const code = getGraphQLErrorCode(error);\n        if (code) {\n          setError(code);\n        } else {\n          setError('Session error');\n        }\n      } finally {\n        setLoaded(true);\n      }\n    });\n\n    return ()=> {\n      unsubscribe();\n    };\n  }, []);\n\n  async function start ({email, password, provider: provider_name}) {\n    const auth = Firebase.auth();\n    const provider_method = popup ? 'signInWithPopup' : 'signInWithRedirect';\n    const dedicated_providers = ['Google', 'Facebook', 'Twitter', 'Github'];\n    const oauth_providers = ['Yahoo', 'Microsoft', 'Apple'];\n\n    function invalidMode () {\n      //throw new Error(`Invalid auth mode: ${provider_name}`);\n    }\n\n    let result;\n    if (provider_name.includes('Email')) {\n      let action;\n      if (provider_name === 'EmailSignin') {\n        action = 'signInWithEmailAndPassword';\n      } else if (provider_name === 'EmailSignup') {\n        action = 'createUserWithEmailAndPassword';\n      } else {\n        invalidMode();\n      }\n\n      result = await auth[action](email, password);\n\n      if (action === 'createUserWithEmailAndPassword') {\n        result = await auth.currentUser.sendEmailVerification();\n      }\n    } else if (dedicated_providers.includes(provider_name)) {\n      const Provider = Firebase.auth[`${provider_name}AuthProvider`];\n      const provider = new Provider();\n      result = await auth[provider_method](provider);\n    } else if (oauth_providers.includes(provider_name)) {\n      const domain = `${provider_name.toLowerCase()}.com`;\n      const provider = new Firebase.auth.OAuthProvider(domain);\n      result = await auth[provider_method](provider);\n    } else {\n      invalidMode();\n    }\n\n    return result;\n  }\n\n  function end () {\n    return Firebase.auth().signOut();\n  }\n\n  function reload () {\n    // TODO: implement reload\n  }\n\n  let $body;\n  if (loaded) {\n    $body = children({user});\n  } else {\n    $body = (\n      <Loading\n        user={user}\n        error={error}\n        reload={reload}\n      />\n    );\n  }\n\n  return (\n    <SessionContext.Provider\n      value={{\n        loaded,\n        error,\n        user,\n        start,\n        reload,\n        end\n      }}\n    >\n      {$body}\n    </SessionContext.Provider>\n  );\n}\n\nSessionProvider.propTypes = {\n  children: PropTypes.func,\n  client: PropTypes.object,\n  SessionUser: PropTypes.func,\n  Loading: PropTypes.func,\n  popup: PropTypes.bool\n};\n\nconst {Consumer: SessionConsumer} = SessionContext;\n\nfunction useSession () {\n  return useContext(SessionContext);\n}\n\nfunction useSessionUser () {\n  const session = useSession();\n  return session.user;\n}\n\nexport {\n  SessionContext,\n  SessionConsumer,\n  SessionProvider,\n  useSession,\n  useSessionUser\n};\n","import gql from 'graphql-tag';\nimport {ApolloClient} from 'apollo-client';\nimport {setContext} from 'apollo-link-context';\nimport {createHttpLink} from 'apollo-link-http';\nimport {InMemoryCache} from 'apollo-cache-inmemory';\n\nexport default function getClient ({uri}) {\n  const http_link = createHttpLink({uri});\n\n  const auth_link = setContext(async (request, prev_context)=> {\n    const {headers = {}} = prev_context;\n    const token = await getToken();\n    if (token) {\n      headers.authorization = token ? `Bearer ${token}` : '';\n    }\n    return {headers};\n  });\n\n  const link = auth_link.concat(http_link);\n  const cache = new InMemoryCache();\n  const client = new ApolloClient({link, cache});\n\n  async function getToken () {\n    const query = gql`\n      {\n        token @client\n      }\n    `;\n    const {data} = await client.query({query});\n    return data.token;\n  }\n\n  function setToken (token) {\n    return client.writeData({data: {token}});\n  }\n\n  function clearToken () {\n    return setToken(null);\n  }\n\n  client.setToken = setToken;\n  client.clearToken = clearToken;\n\n  clearToken();\n  return client;\n}\n","const config = {\n  // Parcel requires explicit env vars\n  apiKey: process.env.FIREBASE_API_KEY,\n  authDomain: process.env.FIREBASE_AUTH_DOMAIN,\n  databaseURL: process.env.FIREBASE_DATABASE_URL,\n  projectId: process.env.FIREBASE_PROJECT_ID,\n  storageBucket: process.env.FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.FIREBASE_APP_ID,\n  measurementId: process.env.FIREBASE_MEASUREMENT_ID\n};\n\nexport default config;\n","import * as React from 'react';\nimport {\n  useEffect,\n  useState\n} from 'react';\nimport PropTypes from 'prop-types';\n\nexport default function PageContainer ({\n  Loading,\n  Error,\n  match,\n  client\n}) {\n  const {params, route} = match;\n  const {page: Page} = route;\n\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [data, setData] = useState(null);\n\n  useEffect(()=> {\n    let unmounted = false;\n    async function runQuery () {\n      if (unmounted) {\n        return;\n      }\n\n      if (!Page.query) {\n        setLoading(false);\n        return;\n      }\n\n      try {\n        const page_query = Page.query(params);\n        const {data} = await client.query(page_query);\n        setData(data);\n      } catch (error) {\n        setError(error);\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    runQuery();\n\n    return ()=> {\n      unmounted = true;\n    };\n  }, []);\n\n  let body;\n  if (loading) {\n    body = (\n      <Loading/>\n    );\n  } else if (error) {\n    body = (\n      <Error error={error}/>\n    );\n  } else {\n    body = (\n      <Page\n        params={params}\n        route={route}\n        {...data}\n      />\n    );\n  }\n\n  return body;\n}\n\nPageContainer.propTypes = {\n  Loading: PropTypes.func,\n  Error: PropTypes.func,\n  match: PropTypes.object,\n  client: PropTypes.object\n};\n","export default function subdomainApps (map) {\n  const main = map.find((item)=> item.main);\n  if (!main) {\n    throw new Error('Must set main flag to true on at least one subdomain app');\n  }\n\n  return function getApp () {\n    const parts = window.location.hostname.split('.');\n\n    let last_index = -2;\n    const last = parts[parts.length - 1];\n    const is_localhost = last === 'localhost';\n    if (is_localhost) {\n      last_index = -1;\n    }\n\n    const subdomain = parts.slice(0, last_index).join('.');\n\n    if (!subdomain) {\n      return main.app;\n    }\n\n    const app = map.find(({subdomains})=> subdomains.includes(subdomain));\n    if (app) {\n      return app.app;\n    } else {\n      return main.app;\n    }\n  };\n}\n"],"names":["getGraphQLErrorCode","error","code","get","_catch","body","recover","result","e","then","SessionContext","createContext","finalizer","bind","SessionProvider","client","children","SessionUser","Loading","popup","start","email","password","provider","provider_name","auth","Firebase","provider_method","dedicated_providers","invalidMode","oauth_providers","includes","action","currentUser","sendEmailVerification","Provider","domain","toLowerCase","OAuthProvider","loaded","setLoaded","useState","setError","user","_setUser","setUser","data","useEffect","unsubscribe","onAuthStateChanged","firebase_user","getIdToken","token","setToken","load","clearToken","end","signOut","reload","$body","React.createElement","propTypes","PropTypes","func","object","bool","Consumer","SessionConsumer","useSession","useContext","useSessionUser","session","getClient","uri","getToken","query","gql","http_link","createHttpLink","auth_link","setContext","request","prev_context","headers","authorization","link","concat","cache","InMemoryCache","ApolloClient","writeData","config","apiKey","process","env","FIREBASE_API_KEY","authDomain","FIREBASE_AUTH_DOMAIN","databaseURL","FIREBASE_DATABASE_URL","projectId","FIREBASE_PROJECT_ID","storageBucket","FIREBASE_STORAGE_BUCKET","messagingSenderId","FIREBASE_MESSAGING_SENDER_ID","appId","FIREBASE_APP_ID","measurementId","FIREBASE_MEASUREMENT_ID","PageContainer","Error","match","params","route","page","Page","loading","setLoading","setData","runQuery","unmounted","page_query","subdomainApps","map","main","find","item","getApp","parts","window","location","hostname","split","last_index","last","length","is_localhost","subdomain","slice","join","app","subdomains"],"mappings":"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"}