{"version":3,"file":"index.modern.js","sources":["../src/logger.js","../src/PageContainer.js","../src/ApplicationContainer.js","../src/Session.js","../src/FirebaseSession.js","../src/getClient.js","../src/getGraphQLErrorCode.js","../src/getSubdomain.js","../src/subdomainApps.js","../src/Router.js"],"sourcesContent":["import Logger from '@hello10/logger';\n\nconst logger = new Logger('jump');\n\nexport default logger;\n","import * as React from 'react';\nimport {useQuery} from '@apollo/client';\n\nimport base_logger from './logger';\n\nconst logger = base_logger.child('PageContainer');\n\nfunction Query ({PageLoading, PageError, Page, ...props}) {\n  const {name, params, user} = props;\n  const {query: query_gql, ...options} = Page.query({params, user});\n  const query = useQuery(query_gql, options);\n  const {loading, error, data} = query;\n\n  logger.debug('Rendering page container query', {...props, loading, error, data});\n\n  if (loading) {\n    logger.debug(`Rendering loading for ${name}`);\n    return (\n      <PageLoading\n        Page={Page}\n        query={query}\n        {...props}\n      />\n    );\n  } else if (error) {\n    logger.debug(`Rendering error for ${name}`);\n    return (\n      <PageError\n        Page={Page}\n        error={error}\n        query={query}\n        {...props}\n      />\n    );\n  } else {\n    logger.debug(`Rendering loaded for ${name}`);\n    return (\n      <Page\n        data={data}\n        query={query}\n        {...props}\n      />\n    );\n  }\n}\n\nexport function PageContainer (props) {\n  const {route, params} = props.match;\n  const {page: Page, name} = route;\n  const page_props = {route, params, name};\n\n  if (!Page) {\n    throw new Error('Page not found in route');\n  }\n\n  if (Page.query) {\n    return (\n      <Query\n        Page={Page}\n        {...props}\n        {...page_props}\n      />\n    );\n  } else {\n    return (\n      <Page\n        data={{}}\n        query={null}\n        {...props}\n        {...page_props}\n      />\n    );\n  }\n}\n","import React, {useEffect} from 'react';\nimport PropTypes from 'prop-types';\n\nimport base_logger from './logger';\nimport {PageContainer} from './PageContainer';\n\nexport default function ApplicationContainer ({\n  ApplicationLoading,\n  Container,\n  PageLoading,\n  PageError,\n  client,\n  useRouter,\n  useSession,\n  ...props\n}) {\n  const logger = base_logger.child('ApplicationContainer');\n  logger.debug('Rendering ApplicationContainer');\n\n  const router = useRouter();\n  const session = useSession();\n\n  useEffect(()=> {\n    logger.debug('Loading session');\n    session.load();\n    return ()=> {\n      logger.debug('Unloading session');\n      session.unload();\n    };\n  }, []);\n\n  useEffect(()=> {\n    logger.debug('Running router', {user: session.user});\n    if (!session.loaded) {\n      return;\n    }\n    const match = router.start({\n      user: session.user\n    });\n    if (match?.redirect) {\n      const {route} = match;\n      let msg = 'Got redirect';\n      const name = route?.name;\n      if (name) {\n        msg = `${msg} to ${name}`;\n      }\n      logger.info(msg, {match});\n    }\n  }, [session.user, session.loaded]);\n\n  if (session.loaded && router.match) {\n    return (\n      <Container\n        match={router.match}\n      >\n        <PageContainer\n          PageLoading={PageLoading}\n          PageError={PageError}\n          match={router.match}\n          client={client}\n          user={session.user}\n          {...props}\n        />\n      </Container>\n    );\n  } else {\n    return (\n      <ApplicationLoading\n        error={session.error || router.error}\n        user={session.user}\n        {...props}\n      />\n    );\n  }\n}\n\nApplicationContainer.whyDidYouRender = {\n  logOnDifferentValues: true\n};\n\nApplicationContainer.propTypes = {\n  ApplicationLoading: PropTypes.func,\n  Container: PropTypes.func,\n  PageLoading: PropTypes.func,\n  PageError: PropTypes.func,\n  client: PropTypes.object,\n  useRouter: PropTypes.func,\n  useSession: PropTypes.func\n};\n","import {mapp} from '@hello10/util';\nimport {useSingleton} from '@hello10/react-hooks';\n\nimport logger from './logger';\n\nconst NO_SESSION = {\n  token: null,\n  refresh_token: null\n};\n\nexport default class Session extends useSingleton.Singleton {\n  initialize () {\n    const {\n      Firebase,\n      SessionUser,\n      client,\n      storage,\n      storage_key = 'JUMP_AUTH',\n      shouldEndSessionOnError = ()=> {\n        return true;\n      }\n    } = this.options;\n\n    client.session = this;\n    SessionUser.client = client;\n    const user = new SessionUser();\n\n    this.Firebase = Firebase;\n    this.SessionUser = SessionUser;\n    this.client = client;\n    this.storage = storage;\n    this.storage_key = storage_key;\n    this.shouldEndSessionOnError = shouldEndSessionOnError;\n\n    this.logger = logger.child({\n      name: 'Session',\n      user\n    });\n\n    this._auth = null;\n\n    if (!storage) {\n      this.logger.info('Client session storage is disabled');\n    }\n\n    return {\n      user,\n      changing: false,\n      loaded: false,\n      error: null\n    };\n  }\n\n  get auth () {\n    return this._auth;\n  }\n\n  get user () {\n    return this.state.user;\n  }\n\n  set user (data) {\n    const user = new this.SessionUser(data);\n    this.setState({user});\n  }\n\n  get changing () {\n    return this.state.changing;\n  }\n\n  get loaded () {\n    return this.state.loaded;\n  }\n\n  get error () {\n    return this.state.error;\n  }\n\n  get load_error () {\n    return this.loaded ? null : this.error;\n  }\n\n  apps (fn) {\n    return mapp(this.Firebase.apps, fn);\n  }\n\n  async load () {\n    this.logger.debug('Loading session');\n    return this._change(async ()=> {\n      this._auth = await this.readAuth();\n      const user = await this.SessionUser.load();\n      this.logger.debug('Session loaded', {user});\n      return {\n        user,\n        loaded: true\n      };\n    });\n  }\n\n  getToken () {\n    return this._auth?.token;\n  }\n\n  unload () {}\n\n  start (args) {\n    this.logger.debug('Starting session');\n    return this._change(async ()=> {\n      const {user, auth} = await this.SessionUser.start(args);\n      this.logger.debug('Session started, setting auth', {user});\n      await this.writeAuth(auth);\n      await this.apps((app)=> {\n        const app_token = auth.app_tokens.find(({name})=> name === app.name);\n        if (!app_token) {\n          return null;\n        }\n        return app.auth().signInWithCustomToken(app_token.token);\n      });\n      return {user};\n    });\n  }\n\n  refresh () {\n    const {SessionUser} = this;\n    if (!SessionUser.refresh) {\n      this.logger.debug('No refresh method defined on SessionUser');\n      return null;\n    }\n\n    this.logger.debug('Refreshing session');\n    return this._change(async ()=> {\n      const data = await SessionUser.refresh(this._auth);\n      const {user, auth} = data;\n      this.logger.debug('Session refreshed', {user});\n      await this.writeAuth(auth);\n      return {user};\n    });\n  }\n\n  end (args) {\n    const {SessionUser} = this;\n    this.logger.debug('Ending session');\n    return this._change(async ()=> {\n      await SessionUser.end(args);\n      await this.apps((app)=> {\n        app.auth().signOut();\n      });\n      const user = new SessionUser();\n      await this.clearAuth();\n      return {user};\n    });\n  }\n\n  async _change (action) {\n    if (!this.changing) {\n      this.setState({changing: true});\n    }\n\n    try {\n      const state = await action();\n      this.setState({\n        changing: false,\n        error: null,\n        ...state\n      });\n    } catch (error) {\n      this.logger.error('Session error', {error});\n      let {user} = this;\n      if (this.shouldEndSessionOnError(error)) {\n        this.logger.debug('Clearing session on error');\n        await this.clearAuth();\n        user = new this.SessionUser();\n      }\n      this.setState({\n        changing: false,\n        user,\n        error\n      });\n    }\n  }\n\n  async writeAuth (auth) {\n    this._auth = auth;\n    const {storage, storage_key} = this;\n    if (storage) {\n      logger.debug('Writing auth to storage');\n      const json = JSON.stringify(auth);\n      await storage.setItem(storage_key, json);\n    }\n  }\n\n  async readAuth () {\n    const {storage, storage_key} = this;\n    let auth = null;\n    if (storage) {\n      logger.debug('Reading auth from storage');\n      try {\n        const json = await storage.getItem(storage_key);\n        auth = JSON.parse(json);\n      } catch (error) {\n        this.logger.error('Error loading session form storage', {error});\n      }\n    }\n    return auth || NO_SESSION;\n  }\n\n  async clearAuth () {\n    this._auth = NO_SESSION;\n    const {storage, storage_key} = this;\n    if (storage) {\n      logger.debug('Clearing auth from storage');\n      await storage.removeItem(storage_key);\n    }\n  }\n}\n","import Session from './Session';\n\nexport default class FirebaseSession extends Session {\n  get auth () {\n    return this.Firebase.auth();\n  }\n\n  async load () {\n    this.logger.debug('Loading session');\n\n    this.setState({changing: true});\n\n    const {SessionUser, client} = this;\n    this.unsubscribe = this.auth.onIdTokenChanged(async (firebase_user)=> {\n      this.logger.debug('Firebase auth state changed', {firebase_user});\n      await this._change(async ()=> {\n        let user;\n        if (firebase_user) {\n          this.logger.debug('Getting firebase user token');\n          const token = await firebase_user.getIdToken(true);\n          this.logger.debug('Loading session user');\n          user = await SessionUser.load({client, token, firebase_user});\n        } else {\n          this.logger.debug('No firebase user clearing session');\n          user = new SessionUser();\n        }\n        return {user, loaded: true};\n      });\n    });\n  }\n\n  getToken () {\n    return this.auth.currentUser?.getIdToken(true);\n  }\n\n  async unload () {\n    this.logger.debug('Unsubscribing from Firebase auth listener');\n    this.unsubscribe();\n  }\n\n  async start ({\n    email,\n    password,\n    provider: provider_name,\n    popup = false\n  }) {\n    const provider_method = popup ? 'signInWithPopup' : 'signInWithRedirect';\n    const dedicated_providers = ['Google', 'Facebook', 'Twitter', 'Github'];\n    const oauth_providers = ['Yahoo', 'Microsoft', 'Apple'];\n\n    function invalidMode () {\n      throw new Error(`Invalid auth mode: ${provider_name}`);\n    }\n\n    const {Firebase, auth} = this;\n\n    try {\n      let credential;\n      if (provider_name.includes('Email')) {\n        if (provider_name === 'EmailSignin') {\n          this.logger.debug('Signing in with email', {email});\n          credential = await auth.signInWithEmailAndPassword(email, password);\n        } else if (provider_name === 'EmailSignup') {\n          this.logger.debug('Signing up with email', {email});\n          credential = await auth.createUserWithEmailAndPassword(email, password);\n          this.logger.debug('Sending session email verification');\n          await credential.user.sendEmailVerification();\n        } else {\n          invalidMode();\n        }\n      } else if (dedicated_providers.includes(provider_name)) {\n        const Provider = Firebase.auth[`${provider_name}AuthProvider`];\n        const provider = new Provider();\n        this.logger.debug('Authorizing via dedicated provider', {provider_name, provider_method});\n        credential = await auth[provider_method](provider);\n      } else if (oauth_providers.includes(provider_name)) {\n        const domain = `${provider_name.toLowerCase()}.com`;\n        const provider = new Firebase.auth.OAuthProvider(domain);\n        this.logger.debug('Authorizing via OAuth provider', {domain, provider_method});\n        credential = await auth[provider_method](provider);\n      } else {\n        invalidMode();\n      }\n      return credential;\n    } catch (error) {\n      this.logger.debug('Error authenticating', error);\n      throw error;\n    }\n  }\n\n  async end () {\n    const {SessionUser} = this;\n    this.logger.debug('Ending session');\n    return this._change(async ()=> {\n      await this.auth.signOut();\n      return {\n        user: new SessionUser()\n      };\n    });\n  }\n}\n","import {\n  ApolloClient,\n  from,\n  HttpLink,\n  InMemoryCache\n} from '@apollo/client';\nimport {setContext} from '@apollo/client/link/context';\n\nimport base_logger from './logger';\n\nexport default function getClient ({\n  uri,\n  options = {},\n  cache_options = {}\n}) {\n  const logger = base_logger.child({name: 'getClient', uri});\n\n  logger.info('Getting client');\n\n  const http_link = new HttpLink({uri});\n\n  let client;\n\n  const auth_link = setContext(async (request, prev_context)=> {\n    const {headers = {}} = prev_context;\n    const {session} = client;\n    if (session) {\n      const token = await session.getToken();\n      if (token) {\n        logger.debug('Adding auth token to header');\n        headers.authorization = token ? `Bearer ${token}` : '';\n      }\n    }\n    return {headers};\n  });\n\n  const link = from([auth_link, http_link]);\n  const cache = new InMemoryCache(cache_options);\n  client = new ApolloClient({link, cache, defaultOptions: options});\n\n  return client;\n}\n","export default function getGraphQLErrorCode (error) {\n  if (error.graphQLErrors) {\n    ([error] = error.graphQLErrors);\n  }\n  return error?.extensions?.code;\n}\n","export default function getSubdomain (hostname) {\n  const parts = hostname.split('.');\n\n  let last_index = -2;\n  const last = parts[parts.length - 1];\n  const is_localhost = last === 'localhost';\n  if (is_localhost) {\n    last_index = -1;\n  }\n\n  return parts.slice(0, last_index).join('.');\n}\n","import getSubdomain from './getSubdomain';\n\nexport default function subdomainApps (map) {\n  const main = map.find((item)=> item.main);\n  if (!main) {\n    throw new Error('Must set main flag to true on at least one subdomain app');\n  }\n\n  return function getApp () {\n    const {hostname} = window.location;\n    const subdomain = getSubdomain(hostname);\n\n    if (!subdomain) {\n      return main.app;\n    }\n\n    const app = map.find(({subdomains})=> subdomains.includes(subdomain));\n    if (app) {\n      return app.app;\n    } else {\n      return main.app;\n    }\n  };\n}\n","import {useSingleton} from '@hello10/react-hooks';\nimport Groutcho from 'groutcho';\n\nimport logger from './logger';\n\nexport default class Router extends useSingleton.Singleton {\n  initialize () {\n    this.history = [];\n\n    if (('web' in this.options)) {\n      this.web = this.options.web;\n    } else {\n      this.web = !!(window && window.location && window.history);\n    }\n\n    if (this.web) {\n      window.addEventListener('popstate', this._onPopState.bind(this));\n    }\n\n    const {routes, redirects} = this.options;\n    this.router = new Groutcho.Router({routes, redirects});\n    this.router.onGo(this._onGo.bind(this));\n\n    this.logger = logger.child({\n      name: 'Router',\n      web: this.web\n    });\n\n    this.logger.debug('Initializing router');\n\n    return {\n      match: null,\n      error: null,\n      input: null\n    };\n  }\n\n  get url () {\n    return this.match?.url;\n  }\n\n  get error () {\n    return this.state.error;\n  }\n\n  get match () {\n    return this.state.match;\n  }\n\n  get route () {\n    return this.match?.route;\n  }\n\n  get params () {\n    return this.match?.params;\n  }\n\n  get page () {\n    return this.route?.page;\n  }\n\n  get input () {\n    return this.state.input;\n  }\n\n  start ({url, ...input}) {\n    this.logger.debug('Router start', {url, input});\n    if (!url) {\n      url = '/';\n      if (this.web) {\n        const {location} = window;\n        const {pathname, search} = location;\n        url = `${pathname}${search}`;\n      }\n    }\n    const match = this.router.match({...input, url});\n    this._handleMatch({match, input});\n    return match;\n  }\n\n  go (args) {\n    args = {\n      ...this.input,\n      ...this.router.normalizeInput(args)\n    };\n    this.logger.debug('Router go', {args, current: this.url});\n    this.router.go(args);\n  }\n\n  back () {\n    const state = this.history.pop();\n    if (!state) {\n      return;\n    }\n    if (this.web) {\n      window.history.back();\n    } else {\n      this._onPopState({state});\n    }\n  }\n\n  _handleMatch ({match, input}) {\n    this.logger.debug('Router handling match', {match, input});\n    if (match) {\n      if (match.url !== this.url) {\n        const state = {url: match.url};\n        this.history.push(state);\n        if (this.web) {\n          window.history.pushState(state, '', match.url);\n        }\n      }\n      this.setState({match, input, error: null});\n    } else {\n      const error = new Error('No match from router');\n      this.setState({match, input, error});\n    }\n  }\n\n  _onGo (match) {\n    this.logger.debug('Router onGo called', {match});\n    const {input} = this;\n    this._handleMatch({match, input});\n    const {onGo} = this.options;\n    if (onGo) {\n      onGo(this.state);\n    }\n  }\n\n  _onPopState ({state}) {\n    const {url} = state;\n    const {input} = this;\n    const match = this.router.match({...input, url});\n    if (match) {\n      this.setState({match, input, error: null});\n    } else {\n      const error = new Error('No match from router');\n      this.setState({match, input, error});\n    }\n  }\n}\n"],"names":["logger","Logger","base_logger","child","Query","PageLoading","PageError","Page","props","name","params","user","query","query_gql","options","useQuery","loading","error","data","debug","React.createElement","PageContainer","route","match","page","page_props","Error","ApplicationContainer","ApplicationLoading","Container","client","useRouter","useSession","router","session","useEffect","load","unload","loaded","start","redirect","msg","info","React","whyDidYouRender","logOnDifferentValues","propTypes","PropTypes","func","object","NO_SESSION","token","refresh_token","Session","useSingleton","Singleton","initialize","Firebase","SessionUser","storage","storage_key","shouldEndSessionOnError","_auth","changing","auth","state","setState","load_error","apps","fn","mapp","_change","readAuth","getToken","args","writeAuth","app","app_token","app_tokens","find","signInWithCustomToken","refresh","end","signOut","clearAuth","action","json","JSON","stringify","setItem","getItem","parse","removeItem","FirebaseSession","unsubscribe","onIdTokenChanged","firebase_user","getIdToken","currentUser","email","password","provider","provider_name","popup","provider_method","dedicated_providers","oauth_providers","invalidMode","credential","includes","signInWithEmailAndPassword","createUserWithEmailAndPassword","sendEmailVerification","Provider","domain","toLowerCase","OAuthProvider","getClient","uri","cache_options","http_link","HttpLink","auth_link","setContext","request","prev_context","headers","authorization","link","from","cache","InMemoryCache","ApolloClient","defaultOptions","getGraphQLErrorCode","graphQLErrors","extensions","code","getSubdomain","hostname","parts","split","last_index","last","length","is_localhost","slice","join","subdomainApps","map","main","item","getApp","window","location","subdomain","subdomains","Router","history","web","addEventListener","_onPopState","bind","routes","redirects","Groutcho","onGo","_onGo","input","url","pathname","search","_handleMatch","go","normalizeInput","current","back","pop","push","pushState"],"mappings":"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"}